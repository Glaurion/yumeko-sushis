<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>YUMEKO SUSHIS — Menu</title>

  <!-- Police Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet" />

  <!-- Favicon / thème -->
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link rel="apple-touch-icon" href="images/favicon.png" />
  <meta name="theme-color" content="#ff4d6d" />

  <style>
    :root{
      --brand:#ff4d6d; --brand-2:#e63956;
      --text:#1a1a1a; --muted:#5c6870;

      --bg-1:#fffaf3;
      --card:#ffffff; --card-border:rgba(0,0,0,.06);
      --accent:#ffd166; --accent-2:#ffc300;

      --sakura-rgb:255,77,109;
      --sakuraAmt: 0;
    }
    *{ box-sizing:border-box; }
    html, body{ height:100%; min-height:100%; scroll-behavior:smooth; }
    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(255,255,255,.6), transparent 60%),
        linear-gradient(180deg, rgba(var(--sakura-rgb), calc(.00 * var(--sakuraAmt))) 0%,
          rgba(var(--sakura-rgb), calc(.35 * var(--sakuraAmt))) 55%, var(--bg-1) 100%), var(--bg-1);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; transition: background 80ms linear;
    }
    @media (max-width: 768px){
      body{
        background:
          radial-gradient(900px 450px at 10% -10%, rgba(255,255,255,.65), transparent 55%),
          linear-gradient(180deg, rgba(var(--sakura-rgb), calc(.00 * var(--sakuraAmt))) 0%,
            rgba(var(--sakura-rgb), calc(.28 * var(--sakuraAmt))) 45%, var(--bg-1) 100%), var(--bg-1);
      }
    }

    .site-header.jp{
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.65));
      border-bottom: 1px solid var(--card-border);
      position: static;
    }
    .site-header .header-inner{
      width:min(96%,1100px); margin:0 auto; padding:14px 8px 10px;
      display:flex; flex-direction:column; align-items:center; gap:8px;
    }
    a.brand{ display:flex; flex-direction:column; align-items:center; gap:6px; text-decoration:none; }
    .logo{
      width:160px; height:160px; border-radius:50%; object-fit:cover; background:#fff;
      box-shadow:0 8px 24px rgba(255,77,109,.15); border:3px solid rgba(255,77,109,.15);
      display:block;
    }
    @media (min-width:768px){ .logo{ width:200px; height:200px; } }
    .brand-text h1{ margin:0; letter-spacing:2px; font-weight:800; font-size:1.4rem; color:#1e1e1e; text-align:center; }

    .main-nav{ display:flex; align-items:center; gap:8px; margin-top:6px; font-weight:600; }
    .main-nav .sep{ color:#7a7a7a; opacity:.6; }
    .main-nav a{
      color:#222; text-decoration:none; padding:6px 10px; border-radius:10px; opacity:.95;
      transition:filter .15s ease, transform .15s ease, background .15s ease;
    }
    .main-nav a:hover{ opacity:1; transform:translateY(-1px); background:rgba(0,0,0,.04); }
    .main-nav a.active{ background:rgba(255,77,109,.12); color:#c2173b; }
    @media (max-width:480px){ .brand-text h1{ font-size:1.2rem; } }

    .container{ max-width:1100px; margin:0 auto; padding:22px; }
    .section{
      background:var(--card); border:1px solid var(--card-border); border-radius:18px;
      padding:22px; box-shadow:0 12px 30px rgba(255,77,109,.08), 0 4px 14px rgba(0,0,0,.04); margin-bottom:22px;
    }
    .section h2{ margin:0 0 8px; font-size:1.7rem; letter-spacing:.5px; color:#1f1f1f; }
    .sep{ height:2px; width:84px; background:linear-gradient(90deg,var(--brand),#d8b26e,transparent); border-radius:2px; margin:6px 0 16px; }

    .cat-nav-wrap{
      position:sticky; top:0; z-index:10;
      padding:10px 0; margin:0 0 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
      backdrop-filter:saturate(120%) blur(2px);
      border-bottom:1px solid rgba(0,0,0,.06);
      border-radius:12px;
    }
    .cat-nav{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:center; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; cursor:pointer; user-select:none;
      background:#fff; border:1px solid var(--card-border);
      font-weight:800; color:#333; transition:transform .12s, box-shadow .12s, background .12s, border-color .12s;
    }
    .pill:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(0,0,0,.06); }
    .pill.active{ background:var(--accent); color:#111; border-color:rgba(0,0,0,.08); }

    .cat-section{
      background:var(--card); border:1px solid var(--card-border); border-radius:16px;
      padding:16px; margin:18px 0; box-shadow:0 10px 26px rgba(255,77,109,.09), 0 3px 10px rgba(0,0,0,.04);
    }
    .cat-header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin:2px 2px 14px; padding-bottom:8px; border-bottom:1px dashed rgba(0,0,0,.08);
      cursor:pointer;
    }
    .cat-title{ margin:0; font-size:1.2rem; letter-spacing:.5px; text-transform:uppercase; color:#c2173b; }
    .btn-mini{
      border:1px solid var(--card-border); background:#fff; color:#222;
      padding:6px 10px; border-radius:10px; font-weight:700; cursor:pointer;
    }
    .btn-mini:hover{ background:#f6f6f6; }

    .menu-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:14px; }
    .item-card{
      background:var(--card); border:1px solid var(--card-border); border-radius:14px; overflow:hidden;
      cursor:pointer; transition:transform .12s, box-shadow .12s, border-color .12s;
      display:flex; flex-direction:column;
    }
    .item-card:hover{ transform:translateY(-2px); box-shadow:0 8px 24px rgba(255,77,109,.15); border-color:rgba(255,77,109,.25); }
    .thumb{ width:100%; aspect-ratio:1/1; object-fit:cover; display:block; background:#fff6ed; }
    .item-name{ font-weight:800; font-size:1.02rem; padding:10px 12px 4px; color:#1f1f1f; }
    .card-body{ padding:0 12px 12px; margin-top:auto; }
    .card-footer{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
      padding-top:10px; border-top:1px dashed rgba(0,0,0,.08);
    }
    .meta{ display:flex; flex-direction:column; gap:2px; align-items:flex-start; line-height:1.15; }
    .pieces{ font-size:.78rem; color:var(--muted); }
    .price{ font-size:.9rem; font-weight:800; color:#0e7a4f; }

    .ctrls{ display:flex; align-items:center; gap:8px; }

    .circle{
      background:var(--accent); color:#111; border:none; width:36px; height:36px; border-radius:12px;
      font-weight:900; cursor:pointer; transition:transform .15s ease, filter .15s ease, box-shadow .15s ease;
      box-shadow:0 4px 0 rgba(0,0,0,.08);
    }
    .circle:hover{ background:var(--accent-2); transform:translateY(-1px); }
    .btn{ border:none; border-radius:10px; padding:8px 12px; font-weight:800; cursor:pointer; }
    .btn-ghost{ background:#f3f3f3; color:#222; }
    .btn-primary{ background:var(--accent); color:#111; box-shadow:0 6px 0 rgba(0,0,0,.06); }
    .btn-primary:hover{ background:var(--accent-2); }

    .qty-badge{ min-width:22px; text-align:center; font-weight:800; color:#1a1a1a; }
    .qty-badge:empty{ display:none; }
    .qty.bump{ transform:scale(1.15); transition:transform .2s; }

    @media (max-width:480px){
      .menu-grid{ grid-template-columns:repeat(2, minmax(0,1fr)); gap:10px; }
      .item-card{ border-radius:12px; }
      .item-name{ font-size:.95rem; padding:8px 10px 2px; }
      .card-body{ padding:0 10px 10px; }
      .circle{ width:34px; height:34px; }
    }

    #stickyBar{
      position:fixed; bottom:0; left:0; right:0; z-index:100;
      background:linear-gradient(180deg,rgba(255,255,255,0),rgba(255,232,237,.35));
      padding:6px;
    }
    #stickyInner{ width:min(96%,1100px); margin:0 auto; display:flex; flex-direction:column; gap:8px; align-items:center; }
    #miniRecap{ display:none !important; }

    #gotoOrder{
      background:var(--accent); color:#111; font-weight:900; border:none; border-radius:14px;
      padding:12px 16px; cursor:pointer; white-space:nowrap;
      transition:filter .15s ease, transform .15s ease, box-shadow .15s ease;
      box-shadow:0 8px 20px rgba(0,0,0,.12);
    }
    #gotoOrder:hover{ background:var(--accent-2); filter:brightness(1.02); transform:translateY(-1px); }

    #sheetOverlay{
      position:fixed; inset:0; background:rgba(0,0,0,.35); backdrop-filter:saturate(110%) blur(2px);
      opacity:0; pointer-events:none; transition:opacity .22s ease; z-index:101;
    }
    #sheetOverlay.open{ opacity:1; pointer-events:auto; }

    #cartSheet{
      position:fixed; left:50%; transform:translateX(-50%); bottom:-100%;
      width:min(96%,1100px); background:#ffffff; color:#131313;
      border:1px solid var(--card-border); border-radius:16px 16px 0 0;
      box-shadow:0 22px 60px rgba(0,0,0,.15); max-height:70vh;
      display:flex; flex-direction:column; transition:bottom .28s ease; z-index:102;
      overscroll-behavior:contain;
    }
    #cartSheet.open{ bottom:0; }
    #cartSheet header, #cartSheet footer{ padding:8px 12px; display:flex; align-items:center; justify-content:space-between; }
    #cartSheet header{ border-bottom:1px solid var(--card-border); }
    #cartSheet footer{ border-top:1px solid var(--card-border); gap:10px; }
    #cartSheet .body{
      padding:8px 10px; overflow:auto; -webkit-overflow-scrolling:touch;
      max-height:calc(70vh - 100px); overscroll-behavior:contain;
    }

    .recap-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
    .recap-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 6px; border-bottom:1px dashed rgba(0,0,0,.08); }
    .thumb.sm{
      width:56px; height:56px; object-fit:cover; border-radius:12px; background:#fff6ed;
      border:1px solid var(--card-border);
    }
    .it-label{ font-weight:600; color:#222; }

    .form-grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field.full{ grid-column:1 / -1; }
    .field label{ font-weight:700; font-size:.92rem; color:#222; }
    .field input, .field textarea{
      background:#fff; border:1px solid var(--card-border); border-radius:10px;
      padding:10px 12px; font-family:inherit; font-size:1rem; color:#111;
    }
    .field input:focus, .field textarea:focus{
      outline:3px solid rgba(255,77,109,.25); border-color:rgba(255,77,109,.45);
    }
    @media (max-width:560px){ .form-grid{ grid-template-columns:1fr; } }

    :focus-visible{ outline:3px solid var(--brand); outline-offset:3px; border-radius:8px; }
    @media (prefers-reduced-motion:reduce){ *{ transition:none !important; animation:none !important; scroll-behavior:auto; } }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    const EMAILJS_PUBLIC_KEY = 'X0lGj86qGqZ49EKOC';
    const EMAILJS_SERVICE_ID = 'service_55t4mql';
    const EMAILJS_TEMPLATE_ID = 'template_9itlkwh';
    const YUMEKO_EMAIL = 'yumeko.sushis@gmail.com';
    (function(){ try{ emailjs.init(EMAILJS_PUBLIC_KEY); }catch(e){ console.warn('EmailJS init error', e); } })();
  </script>
</head>
<body>

  <header class="site-header jp">
    <div class="header-inner">
      <a href="accueil.html" class="brand" aria-label="Accueil - YUMEKO SUSHIS">
        <img src="images/logo-yumeko.png" alt="YUMEKO SUSHIS" class="logo" loading="eager" decoding="async" />
        <div class="brand-text"><h1>YUMEKO SUSHIS</h1></div>
      </a>
      <nav class="main-nav" aria-label="Navigation principale">
        <a href="accueil.html">Accueil</a><span class="sep" aria-hidden="true">・</span>
        <a href="index.html" class="active">Menu</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="section" id="menuSection" aria-labelledby="titre-menu">
      <h2 id="titre-menu">Notre carte</h2>
      <div class="sep" aria-hidden="true"></div>

      <div class="cat-nav-wrap"><div class="cat-nav" id="catNav"></div></div>
      <div id="menu"></div>
    </section>
  </main>

  <div id="stickyBar" aria-live="polite">
    <div id="stickyInner">
      <span id="miniRecap"></span>
      <button id="gotoOrder" type="button">Panier (0) • Valider</button>
    </div>
  </div>

  <div id="sheetOverlay" aria-hidden="true"></div>

  <div id="cartSheet" aria-hidden="true">
    <header>
      <h3>Valider votre commande</h3>
      <button id="sheetClose" aria-label="Fermer" type="button">×</button>
    </header>
    <div class="body">
      <div id="stepCart" class="step active">
        <p class="muted" id="sheetIntro">Vérifie ton panier et ajuste les quantités :</p>
        <ul class="recap-list" id="recapList"></ul>
        <div id="recapComment" class="muted" style="margin-top:4px;"></div>
      </div>
      <div id="stepDetails" class="step" style="display:none">
        <form id="orderForm" action="#" method="post" novalidate>
          <div class="form-grid">
            <div class="field">
              <label for="first_name">Prénom</label>
              <input id="first_name" name="first_name" type="text" required autocomplete="given-name" />
            </div>
            <div class="field">
              <label for="last_name">Nom</label>
              <input id="last_name" name="last_name" type="text" required autocomplete="family-name" />
            </div>
            <div class="field full">
              <label for="email">E-mail</label>
              <input id="email" name="email" type="email" required autocomplete="email" inputmode="email" />
            </div>
            <div class="field full">
              <label for="comments">Allergies / commentaire (optionnel)</label>
              <textarea id="comments" name="comments" rows="3" placeholder="Ex : sans sésame, sauce à part…"></textarea>
            </div>
          </div>
          <input type="hidden" id="hiddenOrder" name="order" value="" />
        </form>
      </div>
    </div>
    <footer>
      <button class="btn btn-ghost" id="closeSheetBtn" type="button">← Retour</button>
      <button class="btn btn-primary" id="goPrimary" type="button">Valider le panier →</button>
    </footer>
  </div>

  <footer style="text-align:center; color:#5b5b5b; margin:28px 0 36px; font-size:.95rem;">
    © 2025 YUMEKO SUSHIS — Les sushis qui font ronronner vos papilles
  </footer>

  <script>
    const categories={
      'LES MAKI':['M1','M2','M3','M4','M5','M6','M7','M8'],
      'LES CALIFORNIA':['C1','C2','C3','C4','C5','C6','C7','C8','C9'],
      'LES MAKI PRINTEMPS':['P1','P2','P3','P4'],
      'LES ROLLS':['R1','R2'],
      'LES SASHIMI':['S1'],
      'LES NIGIRI':['N1','N2'],
      'LES BOISSONS':['B1','B2','B3']
    };
    const catalog={
      M1:{name:'MAKI SAUMON', img:'m1.jpg', pieces:6, comp:'Riz, nori, saumon', allergens:'Poisson', desc:''},
      M2:{name:'MAKI SAUMON AVOCAT', img:'m2.jpg', pieces:6, comp:'Riz, nori, saumon, avocat', allergens:'Poisson', desc:''},
      M3:{name:'MAKI SAUMON CHEESE', img:'m3.jpg', pieces:6, comp:'Riz, nori, saumon, fromage frais', allergens:'Poisson, Lait', desc:''},
      M4:{name:'MAKI CONCOMBRE', img:'m4.jpg', pieces:6, comp:'Riz, nori, concombre', allergens:'—', desc:''},
      M5:{name:'MAKI CONCOMBRE CHEESE', img:'m5.jpg', pieces:6, comp:'Riz, nori, concombre, fromage', allergens:'Lait', desc:''},
      M6:{name:'MAKI AVOCAT', img:'m6.jpg', pieces:6, comp:'Riz, nori, avocat', allergens:'—', desc:''},
      M7:{name:'MAKI AVOCAT CHEESE', img:'m7.jpg', pieces:6, comp:'Riz, nori, avocat, fromage', allergens:'Lait', desc:''},
      M8:{name:'MAKI CHEESE', img:'m8.jpg', pieces:6, comp:'Riz, nori, fromage', allergens:'Lait', desc:''},
      C1:{name:'CALIFORNIA SAUMON', img:'c1.jpg', pieces:8, comp:'Riz, nori, saumon, sésame', allergens:'Poisson, Sésame', desc:''},
      C2:{name:'CALIFORNIA SAUMON AVOCAT', img:'c2.jpg', pieces:8, comp:'Riz, nori, saumon, avocat', allergens:'Poisson', desc:''},
      C3:{name:'CALIFORNIA SAUMON CHEESE', img:'c3.jpg', pieces:8, comp:'Riz, nori, saumon, fromage', allergens:'Poisson, Lait', desc:''},
      C4:{name:'CALIFORNIA CONCOMBRE', img:'c4.jpg', pieces:8, comp:'Riz, nori, concombre', allergens:'—', desc:''},
      C5:{name:'CALIFORNIA CONCOMBRE CHEESE', img:'c5.jpg', pieces:8, comp:'Riz, nori, concombre, fromage', allergens:'Lait', desc:''},
      C6:{name:'CALIFORNIA AVOCAT', img:'c6.jpg', pieces:8, comp:'Riz, nori, avocat', allergens:'—', desc:''},
      C7:{name:'CALIFORNIA AVOCAT CHEESE', img:'c7.jpg', pieces:8, comp:'Riz, nori, avocat, fromage', allergens:'Lait', desc:''},
      C8:{name:'CALIFORNIA CHEESE', img:'c8.jpg', pieces:8, comp:'Riz, nori, fromage', allergens:'Lait', desc:''},
      C9:{name:'CALIFORNIA SAUMON CHEESE OIGNONS FRITS', img:'c9.jpg', pieces:8, comp:'Riz, nori, saumon, fromage, oignons frits', allergens:'Poisson, Lait, Gluten', desc:''},
      P1:{name:'MAKI PRINTEMPS SAUMON AVOCAT', img:'p1.jpg', pieces:6, comp:'Riz, feuille de riz, saumon, avocat', allergens:'Poisson', desc:''},
      P2:{name:'MAKI PRINTEMPS SAUMON CHEESE', img:'p2.jpg', pieces:6, comp:'Riz, feuille de riz, saumon, fromage', allergens:'Poisson, Lait', desc:''},
      P3:{name:'MAKI PRINTEMPS CONCOMBRE CHEESE', img:'p3.jpg', pieces:6, comp:'Riz, feuille de riz, concombre, fromage', allergens:'Lait', desc:''},
      P4:{name:'MAKI PRINTEMPS AVOCAT CHEESE', img:'p4.jpg', pieces:6, comp:'Riz, feuille de riz, avocat, fromage', allergens:'Lait', desc:''},
      R1:{name:'ROLLS SAUMON AVOCAT CHEESE', img:'r1.jpg', pieces:8, comp:'Riz, nori, saumon, avocat, fromage', allergens:'Poisson, Lait', desc:''},
      R2:{name:'ROLLS AVOCAT SAUMON CHEESE', img:'r2.jpg', pieces:8, comp:'Riz, nori, avocat, saumon, fromage', allergens:'Poisson, Lait', desc:''},
      S1:{name:'SASHIMI SAUMON', img:'s1.jpg', pieces:2, comp:'Tranches de saumon', allergens:'Poisson', desc:''},
      N1:{name:'NIGIRI SAUMON', img:'n1.jpg', pieces:2, comp:'Riz, saumon', allergens:'Poisson', desc:''},
      N2:{name:'NIGIRI AVOCAT', img:'n2.jpg', pieces:2, comp:'Riz, avocat', allergens:'—', desc:''},
      B1:{name:'BIERE TSINGTAO', img:'b1.jpg'},
      B2:{name:'BIERE ASAHI', img:'b2.jpg'},
      B3:{name:'COCA COLA ZERO', img:'b3.jpg'}
    };
    const prices={};
    const fmt=new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});

    function slugifyCat(label){ return 'cat-' + label.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-]/g,''); }

    function buildCategoryNav(){
      const nav=document.getElementById('catNav'); nav.innerHTML='';
      Object.keys(categories).forEach((cat)=>{
        const id=slugifyCat(cat);
        const btn=document.createElement('button');
        btn.className='pill'; btn.type='button'; btn.dataset.target='#'+id; btn.textContent=cat;
        btn.addEventListener('click', ()=>{
          const already=btn.classList.contains('active');
          document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
          document.querySelectorAll('.cat-section').forEach(sec=>sec.style.display='');
          if(!already){
            btn.classList.add('active');
            document.querySelectorAll('.cat-section').forEach(sec=>{ sec.style.display=(sec.id===id)?'':'none'; });
            const target=document.getElementById(id);
            const grid=target?.querySelector('.menu-grid');
            const toggle=target?.querySelector('[data-action="collapse"]');
            if(grid && grid.style.display==='none'){ grid.style.display=''; toggle.textContent='Réduire'; target.querySelector('.cat-header')?.setAttribute('aria-expanded','true'); }
            const y=target.getBoundingClientRect().top + window.scrollY - 80;
            window.scrollTo({top:y, behavior:'smooth'});
          }
        });
        nav.appendChild(btn);
      });
    }

    function buildMenu(){
      const menu=document.getElementById('menu'); menu.innerHTML='';
      for(const [cat,codes] of Object.entries(categories)){
        const sec=document.createElement('section');
        sec.className='cat-section'; sec.id=slugifyCat(cat);

        const header=document.createElement('div');
        header.className='cat-header'; header.setAttribute('role','button'); header.setAttribute('aria-expanded','false');
        header.innerHTML=`<h3 class="cat-title">${cat}</h3>
          <button type="button" class="btn-mini" data-action="collapse">Déplier</button>`;

        const grid=document.createElement('div'); grid.className='menu-grid';

        codes.forEach(code=>{
          const d=catalog[code]||{name:code, img:code.toLowerCase()+'.jpg'};
          const name=d.name||code;
          const img='images/'+(d.img || (code.toLowerCase()+'.jpg'));
          const pieces=d.pieces ?? '';
          const basePrice=(prices.hasOwnProperty(code)?prices[code]:(typeof d.price==='number'?d.price:undefined));
          const priceStr=(typeof basePrice==='number')? fmt.format(basePrice) : '—';

          const card=document.createElement('div'); card.className='item-card'; card.dataset.code=code; card.dataset.name=name;
          card.innerHTML=`
            <img class="thumb" loading="lazy" decoding="async" src="${img}" alt="${name}" onerror="this.style.display='none'">
            <div class="item-name">${name}</div>
            <div class="card-body">
              <div class="card-footer">
                <div class="meta">
                  <span class="pieces">${pieces? pieces+' PIECES' : ''}</span>
                  <span class="price">${priceStr}</span>
                </div>
                <div class="ctrls">
                  <span class="qty-badge qty" data-item="${code}- ${name}"></span>
                  <button class="circle card-plus" data-item="${code}- ${name}" type="button" aria-label="Ajouter ${name}">+</button>
                </div>
              </div>
            </div>`;
          grid.appendChild(card);
        });

        grid.style.display='none'; /* replié par défaut */
        sec.appendChild(header); sec.appendChild(grid); menu.appendChild(sec);
      }

      /* Toggle catégorie (uniquement sur l’en-tête ou le bouton "Déplier/Réduire") */
      menu.addEventListener('click',(e)=>{
        const header=e.target.closest('.cat-header');
        const btn=e.target.closest('.btn-mini');
        if(!header && !btn) return;
        const sec=(header||btn).closest('.cat-section'); if(!sec) return;
        const grid=sec.querySelector('.menu-grid');
        const toggle=sec.querySelector('[data-action="collapse"]');
        const hidden = grid.style.display==='none';
        grid.style.display = hidden ? '' : 'none';
        toggle.textContent = hidden ? 'Réduire' : 'Déplier';
        sec.querySelector('.cat-header')?.setAttribute('aria-expanded', hidden ? 'true' : 'false');
      });
    }

    /* ==== Ouverture/fermeture panier ==== */
    function setupCartSheet(){
      const sheet = document.getElementById('cartSheet');
      const overlay = document.getElementById('sheetOverlay');
      const btnOpenEl = document.getElementById('gotoOrder');
      const btnBackClose = document.getElementById('closeSheetBtn');
      const sheetClose = document.getElementById('sheetClose');
      const btnPrimary = document.getElementById('goPrimary');
      const stepCart = document.getElementById('stepCart');
      const stepDetails = document.getElementById('stepDetails');
      const form = document.getElementById('orderForm');
      let currentStep='cart';

      const disableScroll = (e)=>{ if(!document.body.classList.contains('modal-open')) return; if(!sheet.contains(e.target)){ e.preventDefault(); } };
      function openSheet(){ setStep('cart'); sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false');
        overlay.classList.add('open'); overlay.setAttribute('aria-hidden','false'); document.body.classList.add('modal-open');
        window.addEventListener('touchmove', disableScroll, {passive:false}); window.addEventListener('wheel', disableScroll, {passive:false}); }
      function closeSheet(){ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true');
        overlay.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); document.body.classList.remove('modal-open');
        window.removeEventListener('touchmove', disableScroll); window.removeEventListener('wheel', disableScroll); }
      function setStep(which){ currentStep=which; const isCart=(which==='cart'); stepCart.style.display=isCart?'':'none'; stepDetails.style.display=isCart?'none':''; btnPrimary.textContent=isCart?'Valider le panier →':'Commander →'; if(!isCart){ form?.querySelector('#first_name')?.focus(); } }

      btnOpenEl?.addEventListener('click', openSheet);
      sheetClose?.addEventListener('click', closeSheet);
      btnBackClose?.addEventListener('click', ()=>{ if(currentStep==='details'){ setStep('cart'); } else{ closeSheet(); } });
      overlay?.addEventListener('click', closeSheet);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && sheet.classList.contains('open')) closeSheet(); });

      /* (le reste du checkout/EmailJS identique à ta version précédente — non modifié pour se concentrer sur le bug de clic) */
    }

    /* ==== Modale produit ==== */
    function openItemModal(code, name){
      const d=window.catalog[code]||{};
      const img='images/'+(d.img || (code.toLowerCase()+'.jpg'));
      document.getElementById('mImg').src=img;
      document.getElementById('mImg').alt=name;
      document.getElementById('mTitle').textContent=name;
      document.getElementById('mPieces').textContent=d.pieces ?? '—';
      document.getElementById('mAllergens').textContent=d.allergens || 'Non renseigné';
      document.getElementById('mComp').textContent=d.comp || 'Non renseigné';
      document.getElementById('mDesc').textContent=d.desc || '—';

      const itemKey=`${code}- ${name}`;
      const qtySpan=document.querySelector(`.qty[data-item="${CSS.escape(itemKey)}"]`);
      const current=parseInt(qtySpan?.textContent)||0;
      const mQty=document.getElementById('mQty');
      const mMinus=document.getElementById('mMinus');
      mQty.textContent=current;
      mMinus.style.visibility=current>0?'visible':'hidden';
      mMinus.dataset.item=itemKey;
      document.getElementById('mPlus').dataset.item=itemKey;

      const modal=document.getElementById('itemModal');
      modal.style.display='flex';
      modal.setAttribute('aria-hidden','false');
    }
    function openItemModalByKey(itemKey){
      const code=(String(itemKey).split('-')[0]||'').trim();
      const name=String(itemKey).split('-').slice(1).join('-').trim();
      if(!code || !name) return;
      openItemModal(code, name);
    }

    /* ==== FIX CLICS : un SEUL écouteur global 'click' fiable desktop + mobile ==== */
    function setupMenuClicks(){
      document.addEventListener('click', function(e){
        // 1) Clic sur bouton +
        const plusBtn = e.target.closest('.card-plus');
        if(plusBtn){
          e.preventDefault(); e.stopPropagation();
          openItemModalByKey(plusBtn.dataset.item);
          return;
        }
        // 2) Clic sur la carte (hors zone des contrôles)
        const card = e.target.closest('.item-card');
        if(card && !e.target.closest('.ctrls')){
          e.preventDefault(); e.stopPropagation();
          openItemModal(card.dataset.code, card.dataset.name);
          return;
        }
      }, false);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      buildCategoryNav();
      buildMenu();
      setupMenuClicks();
      setupCartSheet();
    });
  </script>

  <script>
    (function(){
      const here = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.main-nav a').forEach(a=>{
        const href = a.getAttribute('href');
        if(href && !href.startsWith('#') && here === href) a.classList.add('active');
      });
    })();
    (function(){
      const root = document.documentElement;
      function updateSakura(){
        const doc = document.documentElement;
        const max = (doc.scrollHeight - window.innerHeight) || 1;
        const p = Math.min(1, Math.max(0, window.scrollY / max));
        const eased = 1 - Math.pow(1 - p, 1.6);
        root.style.setProperty('--sakuraAmt', eased.toFixed(3));
      }
      updateSakura();
      window.addEventListener('scroll', updateSakura, {passive:true});
      window.addEventListener('resize', updateSakura);
    })();
  </script>

  <!-- Modale produit -->
  <div id="itemModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center;z-index:103" aria-hidden="true">
    <div style="background:#fff;border-radius:16px;border:1px solid var(--card-border);width:min(92%,560px);max-height:80vh;overflow:auto;box-shadow:0 16px 40px rgba(0,0,0,.15)">
      <div style="display:flex;gap:14px;padding:14px;align-items:flex-start">
        <img id="mImg" alt="" style="width:140px;height:140px;object-fit:cover;border-radius:12px;background:#fff6ed;border:1px solid var(--card-border)" />
        <div style="flex:1;min-width:0">
          <h4 id="mTitle" style="margin:6px 0 6px;font-size:1.15rem">Produit</h4>
          <p style="margin:0;color:var(--muted);font-size:.9rem">
            <strong>Pièces:</strong> <span id="mPieces">—</span> ・
            <strong>Allergènes:</strong> <span id="mAllergens">—</span>
          </p>
          <p id="mComp" style="margin:8px 0;color:#2f2f2f;font-size:.95rem">—</p>
          <p id="mDesc" style="margin:6px 0;color:#6b6b6b;font-size:.9rem">—</p>
        </div>
        <button id="mClose" aria-label="Fermer" type="button" style="background:transparent;border:none;font-size:1.4rem;line-height:1;padding:4px 6px">×</button>
      </div>
      <div style="display:flex;align-items:center;justify-content:flex-end;gap:8px;padding:14px;border-top:1px solid var(--card-border)">
        <button id="mMinus" class="btn btn-ghost" type="button">−</button>
        <span id="mQty" class="qty" style="min-width:20px;text-align:center;font-weight:800">0</span>
        <button id="mPlus" class="btn btn-primary" type="button">+</button>
      </div>
    </div>
  </div>

  <script>
    // Contrôles de la modale (fermeture + +/-)
    (function(){
      const modal=document.getElementById('itemModal');
      const closeBtn=document.getElementById('mClose');
      const mMinus=document.getElementById('mMinus');
      const mPlus=document.getElementById('mPlus');
      const mQty=document.getElementById('mQty');

      function setQty(itemKey,newVal){
        const span=document.querySelector(`.qty[data-item="${CSS.escape(itemKey)}"]`);
        if(!span) return;
        span.textContent = newVal>0 ? String(newVal) : '';
        mQty.textContent=newVal;
        document.getElementById('mMinus').style.visibility=newVal>0?'visible':'hidden';
      }
      mMinus.addEventListener('click', ()=>{ const key=mMinus.dataset.item; if(!key) return; const cur=parseInt(mQty.textContent)||0; setQty(key, Math.max(0,cur-1)); });
      mPlus .addEventListener('click', ()=>{ const key=mPlus.dataset.item ; if(!key) return; const cur=parseInt(mQty.textContent)||0; setQty(key, cur+1); });

      closeBtn.addEventListener('click', ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } );
      modal.addEventListener('click', (e)=>{ if(e.target===modal){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.style.display==='flex'){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } });
    })();
  </script>
</body>
</html>
