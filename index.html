<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YUMEKO SUSHIS</title>
  <style>
    :root{
      /* Couleurs du thème */
      --brand:#8b0000;          /* rouge foncé */
      --brand-2:#a31212;        /* rouge hover */
      --text:#f8f8f8;
      --card:#1b1b1b;
      --muted:#cfcfcf;
      --accent:#ffb6b6;
      --accent-2:#ff8c8c;
      /* On retire totalement la section de la page */
#orderSection { display: none !important; }


      /* Opacité du dégradé du bandeau (mise à jour au scroll via JS) */
      --barShade: .35;
    }

    *{ box-sizing: border-box; }

    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(180deg, #0f0f0f 0%, #8b0000 100%);
      color:var(--text); min-height:100vh;
    }

    /* HERO */
    .hero{
      background:linear-gradient(to bottom,rgba(0,0,0,.55),rgba(0,0,0,.75)),url('images/hero.jpg') center/cover no-repeat;
      padding:60px 20px; text-align:center;
    }
    h1.brand{ font-size:2.5rem; margin:10px 0; letter-spacing:2px; font-weight:800; }
    .cta{ background:var(--brand); border:none; color:#fff; padding:14px 18px; border-radius:10px; font-weight:800; cursor:pointer; }
    .cta:hover{ background:var(--brand-2); }

    /* LAYOUT & SECTIONS */
    .container{ max-width:1100px; margin:0 auto; padding:20px; }
    .section{ background:#160c0c; border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.25); margin-bottom:25px;}
    .section-title{ color:#fff; font-size:1.8rem; margin-bottom:10px; }

    /* MENU */
    .menu-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .item-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .left{ display:flex; align-items:center; gap:10px; min-width:0; }
    .thumb{ width:60px; height:60px; border-radius:10px; object-fit:cover; background:#0d0d0d; box-shadow:0 0 8px rgba(0,0,0,.35); }
    .item-name{ font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .controls{ display:flex; align-items:center; gap:8px; }
    .btn{ background:var(--accent); border:none; color:#111; width:34px; height:34px; border-radius:50%; font-weight:900; cursor:pointer; transition:transform .15s; }
    .btn:hover{ background:var(--accent-2); transform:scale(1.1); }
    .qty{ min-width:22px; text-align:center; font-weight:800; }
    .qty.bump{ transform:scale(1.15); transition:transform .2s; }

    /* FORM */
    form input, form textarea{ width:90%; max-width:520px; background:#161616; color:#fff; border:1px solid rgba(255,255,255,.2); border-radius:10px; padding:10px; margin:6px auto; display:block; }
    textarea{ resize:vertical; min-height:90px; }
    .muted{ color:#cfcfcf; opacity:.95; font-size:14px; }

    /* STICKY BAR (une seule définition, pilotée par --barShade) */
    #stickyBar{
      position:fixed; bottom:0; left:0; right:0; z-index:100;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,var(--barShade)));
      padding:10px;
    }
    #stickyInner{ width:min(96%,1100px); margin:0 auto; }
    #gotoOrder{ width:100%; background:var(--brand); color:#fff; font-weight:900; border:none; border-radius:12px; padding:14px; cursor:pointer; }

    /* TIROIR RÉCAP */
    #cartSheet{
      position:fixed; left:50%; transform:translateX(-50%); bottom:-100%;
      width:min(96%,1100px); background:#1b1b1b; color:#fff;
      border:1px solid rgba(255,255,255,.12); border-radius:16px 16px 0 0;
      box-shadow:0 22px 60px rgba(0,0,0,.45); max-height:70vh;
      display:flex; flex-direction:column; transition:bottom .28s ease; z-index:101;
    }
    #cartSheet.open{ bottom:62px; }
    #cartSheet header, #cartSheet footer{ padding:10px 12px; display:flex; align-items:center; justify-content:space-between; }
    #cartSheet header{ border-bottom:1px solid rgba(255,255,255,.1); }
    #cartSheet footer{ border-top:1px solid rgba(255,255,255,.1); gap:10px; justify-content:flex-end; }
    #cartSheet header h3{ margin:0; font-size:18px; }
    #cartSheet header button{ background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer; }
    #cartSheet .body{ padding:10px; overflow:auto; }
    .recap-list{ list-:none; margin:0; padding:0; }
    .recap-list li{ display:flex; justify-content:space-between; padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,.1); }

    footer{ text-align:center; color:#d7d7d7; margin:60px 0 120px; }
    .shake{ animation:shake .35s; } 
    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-4px);}50%{transform:translateX(4px);}75%{transform:translateX(-2px);}}
<script>
/* ======== PANIER / TIROIR : déplacer le formulaire et tout gérer ici ======== */
document.addEventListener('DOMContentLoaded', function () {
  const sheet       = document.getElementById('cartSheet');
  const sheetBody   = sheet?.querySelector('.body');
  const sheetClose  = document.getElementById('sheetClose');
  const btnOpen     = document.getElementById('gotoOrder');
  const btnEdit     = document.getElementById('editOrder');
  const btnConfirm  = document.getElementById('confirmSend');
  const recapList   = document.getElementById('recapList');
  const recapOpt    = document.getElementById('recapOptions');
  const recapPickup = document.getElementById('recapPickup');
  const recapCom    = document.getElementById('recapComment');
  const form        = document.getElementById('orderForm');
  const orderResult = document.getElementById('orderResult');

  if (!sheet || !sheetBody || !btnOpen || !recapList || !recapOpt || !recapPickup || !recapCom) {
    console.warn('[cart] éléments requis manquants');
    return;
  }

  // 1) Déplacer le formulaire dans le tiroir (même si aucun article)
  if (form && !sheetBody.contains(form)) {
    sheetBody.appendChild(form);
  }

  // ---- Utilitaires globaux sûrs ----
  function safeInt(el){ return Math.max(0, parseInt(el?.textContent ?? '0') || 0); }

  // Fallback si collectOptions n’existe pas (au cas où le code amont change)
  function collectOptionsSafe(){
    if (typeof collectOptions === 'function') return collectOptions();
    const bagQtyEl = document.getElementById('bagQty');
    const bag = safeInt(bagQtyEl);
    const map = [
      ['sojaSucree','Soja sucrée'],
      ['sojaSalee','Soja salée'],
      ['wasabi','Wasabi'],
      ['gingembre','Gingembre']
    ];
    const opts=[];
    map.forEach(([key,label])=>{
      const qty = safeInt(document.querySelector(`.opt-qty[data-opt="${key}"]`));
      if (qty>0) opts.push(`${label} x${qty}`);
    });
    return { opts, bag };
  }

  function getCartItems(){
    const items = [];
    document.querySelectorAll('.qty[data-item]').forEach(span=>{
      const qty = safeInt(span);
      if (qty > 0) {
        items.push({ label: span.dataset.item, qty });
      }
    });
    return items;
  }

  function buildRecap(){
    // Items
    const items = getCartItems();
    recapList.innerHTML = '';
    if (items.length === 0) {
      recapList.innerHTML = '<li class="muted">Aucun article pour le moment.</li>';
    } else {
      items.forEach(({label, qty})=>{
        const li = document.createElement('li');
        li.innerHTML = `<span>${label}</span><strong>x${qty}</strong>`;
        recapList.appendChild(li);
      });
    }

    // Options (soja, wasabi, gingembre + baguettes)
    const {opts, bag} = collectOptionsSafe();
    const parts = [];
    if (opts.length) parts.push(opts.join(' • '));
    parts.push(`Baguettes x${bag}`);
    recapOpt.textContent = parts.join(' — ');

    // Retrait (date/heure)
    const d = document.getElementById('pickupDate')?.value || '';
    const t = document.getElementById('pickupTime')?.value || '';
    recapPickup.textContent = (d || t) ? `Retrait : ${[d,t].filter(Boolean).join(' à ')}` : '';

    // Commentaire
    const c = document.getElementById('comments')?.value?.trim() || '';
    recapCom.textContent = c ? `Commentaire : ${c}` : '';
  }

  // 3) Ouvrir / fermer — s’ouvre TOUJOURS (même à 0 article)
  function openSheet(){
    buildRecap();
    sheet.classList.add('open');
    sheet.setAttribute('aria-hidden','false');
  }
  function closeSheet(){
    sheet.classList.remove('open');
    sheet.setAttribute('aria-hidden','true');
  }

  btnOpen.addEventListener('click', openSheet);
  sheetClose?.addEventListener('click', closeSheet);

  // Échap pour fermer
  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Escape' && sheet.classList.contains('open')) closeSheet();
  });

  // 4) Bouton "Modifier" → revenir voir le menu (et fermer le tiroir)
  btnEdit?.addEventListener('click', ()=>{
    closeSheet();
    document.getElementById('menuSection')?.scrollIntoView({behavior:'smooth'});
  });

  // 5) Préparer le texte d’ordre pour Formspree (champ caché "order")
  function ensureHiddenField(name){
    if (!form) return null;
    let input = form.querySelector(`input[name="${name}"]`);
    if (!input) {
      input = document.createElement('input');
      input.type = 'hidden';
      input.name = name;
      form.appendChild(input);
    }
    return input;
  }

  function prepareOrderText(){
    const itemsText = getCartItems()
      .map(({label, qty})=>`- ${label} x${qty}`)
      .join('\n');
    const {opts, bag} = collectOptionsSafe();
    const d = document.getElementById('pickupDate')?.value || '—';
    const t = document.getElementById('pickupTime')?.value || '—';
    const c = document.getElementById('comments')?.value?.trim() || '—';
    const name = form?.querySelector('[name="name"]')?.value || '—';
    const phone = form?.querySelector('[name="phone"]')?.value || '—';

    const text =
`Commande YUMEKO
Client : ${name}
Téléphone : ${phone}

Articles :
${itemsText || '(aucun)'}

Options : ${opts.length ? opts.join(', ') : 'aucune'}
Baguettes : ${bag}

Retrait : ${d} ${t}
Commentaire : ${c}`;

    const hidden = ensureHiddenField('order');
    if (hidden) hidden.value = text;
  }

  // 6) Envoi : le bouton du tiroir déclenche l’envoi du formulaire
  btnConfirm?.addEventListener('click', ()=>{
    if (!form) return;
    prepareOrderText();
    form.requestSubmit(); // déclenche la soumission native
  });

  // 7) Soumission via fetch pour afficher un retour dans le tiroir
  if (form) {
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if (orderResult) orderResult.textContent = 'Envoi en cours…';
      try{
        const fd = new FormData(form);
        const res = await fetch(form.action, {
          method: 'POST',
          body: fd,
          headers: { 'Accept': 'application/json' }
        });
        if (res.ok) {
          if (orderResult) orderResult.textContent = 'Merci ! Votre commande a été envoyée ✅';
          // Vider le panier + options + commentaire (sans fermer le tiroir)
          document.querySelectorAll('.qty[data-item]').forEach(q=>q.textContent='0');
          document.querySelectorAll('.opt-qty').forEach(q=>q.textContent='0');
          const bagQtyEl = document.getElementById('bagQty');
          const bagInput = document.getElementById('bagInput');
          if (bagQtyEl) bagQtyEl.textContent = '1';
          if (bagInput) bagInput.value = '1';
          document.getElementById('comments')?.value = '';
          document.getElementById('pickupDate')?.value = '';
          document.getElementById('pickupTime')?.value = '';
          // Mettre à jour l’UI
          if (typeof updateSticky === 'function') updateSticky();
          buildRecap();
        } else {
          if (orderResult) orderResult.textContent = 'Oups, une erreur est survenue. Réessayez.';
        }
      } catch(err){
        if (orderResult) orderResult.textContent = 'Réseau indisponible. Vérifiez votre connexion.';
      }
    });
  }

  // 8) Rebuild récap si l’utilisateur modifie des champs dans le tiroir
  sheet.addEventListener('input', (e)=>{
    if (e.target.matches('textarea,input')) buildRecap();
  });

  // 9) Rebuild récap à chaque clic +/- sur les articles ou options
  document.addEventListener('click', (e)=>{
    if (e.target.classList.contains('plus') || e.target.classList.contains('minus') ||
        e.target.classList.contains('opt-plus') || e.target.classList.contains('opt-minus')) {
      // Laisse le DOM mettre à jour les quantités, puis reconstruit
      setTimeout(buildRecap, 0);
    }
  });

  // 10) Ouvre le tiroir si ancre #panier (#cart) est utilisée (optionnel)
  if (location.hash === '#panier' || location.hash === '#cart') {
    openSheet();
  }
});
</script>

  /* ===== Ombre du bandeau qui fonce avec le scroll ===== */
  (function(){
    const root = document.documentElement;
    function updateBarShade(){
      const doc = document.documentElement;
      const max = (doc.scrollHeight - window.innerHeight) || 1;
      const p = Math.min(1, Math.max(0, window.scrollY / max)); // 0 top → 1 bottom
      const shade = 0.35 + (0.85 - 0.35) * p; // de 0.35 à 0.85
      root.style.setProperty('--barShade', shade.toFixed(2));
    }
    updateBarShade();
    window.addEventListener('scroll', updateBarShade, { passive:true });
    window.addEventListener('resize', updateBarShade);
  })();

  /* ===================== Données ===================== */
  const categories = {
  'Maki 4 pièces': [
    'M1- Saumon','M2- Saumon/Avocat','M3- Saumon/Cheese','M4- Thon',
    'M5- Concombre','M6- Concombre/Cheese','M7- Avocat','M8- Avocat/Cheese',
    'M9- Fromage'                 // ⟵ NOUVEAU
  ],
  'California 4 pièces': [
    'C1- Saumon','C2- Saumon/Avocat','C3- Saumon/Cheese','C4- Thon',
    'C5- Concombre','C6- Concombre/Cheese','C7- Avocat','C8- Avocat/Cheese',
    'C9- Fromage'                 // ⟵ NOUVEAU
  ],
  'Maki printemps 4 pièces': [
    'P1- Saumon/Avocat','P2- Saumon/Fromage','P3- Concombre/Fromage','P4- Avocat/Fromage'
  ],
  'Signature 4 pièces': [
    'S1- California Saumon/Cheese/Oignons frits','S2- Rols Saumon/Avocat/Cheese'
  ],
  'Sashimi 2 pièces': ['Saumon'],
  'Nigiri 2 pièces': ['N1- Saumon','N2- Avocat']
};

  const prices = {}; // ex: {'M1':4.00}

  /* ===================== Construction du menu ===================== */
  function buildMenu(){
    const menu=document.getElementById('menu');
    for(const [cat,items] of Object.entries(categories)){
      const wrap=document.createElement('div');
      wrap.className='category';
      wrap.innerHTML=`<h3>${cat}</h3><div class="menu-grid"></div>`;
      const grid=wrap.querySelector('.menu-grid');

      items.forEach(item=>{
        const code=item.split('-')[0].trim();
        const name=item.split('-').slice(1).join('-').trim();
        const price=prices[code];

        const card=document.createElement('div');
        card.className='item-card';
        card.innerHTML=`
          <div class="left">
            <img class="thumb" src="images/${code.toLowerCase()}.jpg" alt="${item}" onerror="this.style.display='none'">
            <div class="item-name">${name || item}</div>
          </div>
          <div class="controls">
            ${price!==undefined?`<span class="muted" style="margin-right:6px">${price.toFixed(2)}€</span>`:''}
            <button class="btn minus" data-item="${item}">−</button>
            <span class="qty" data-item="${item}">0</span>
            <button class="btn plus" data-item="${item}">+</button>
          </div>`;
        grid.appendChild(card);
      });

      menu.appendChild(wrap);
    }
  }
  buildMenu();

  /* ===================== Utilitaires ===================== */
  function bump(el){ el.classList.add('bump'); setTimeout(()=>el.classList.remove('bump'),200); }
  function getTotal(){ let t=0; document.querySelectorAll('.qty[data-item]').forEach(q=>t+=parseInt(q.textContent)||0); return t; }
  function updateSticky(){ document.getElementById('gotoOrder').textContent = `Panier (${getTotal()}) • Valider`; }

  document.addEventListener('click', e=>{
    if(e.target.classList.contains('plus') || e.target.classList.contains('minus')){
      const inc = e.target.classList.contains('plus') ? 1 : -1;
      const item = e.target.dataset.item;
      const span = document.querySelector(`.qty[data-item="${item}"]`);
      const v = Math.max(0, (parseInt(span.textContent)||0) + inc);
      span.textContent = v; bump(span); updateSticky();
    }
  });

  // Baguettes
  const bagMinus = document.getElementById('bagMinus');
  const bagPlus  = document.getElementById('bagPlus');
  const bagQty   = document.getElementById('bagQty');
  const bagInput = document.getElementById('bagInput');
  bagMinus.onclick = ()=>{ const v=Math.max(0,(parseInt(bagQty.textContent)||0)-1); bagQty.textContent=v; bagInput.value=v; bump(bagQty); };
  bagPlus.onclick  = ()=>{ const v=(parseInt(bagQty.textContent)||0)+1; bagQty.textContent=v; bagInput.value=v; bump(bagQty); };

// Gestion des boutons + / - pour les options
document.querySelectorAll('.opt-plus').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const key = btn.dataset.opt;
    const qtyEl = document.querySelector(`.opt-qty[data-opt="${key}"]`);
    qtyEl.textContent = parseInt(qtyEl.textContent) + 1;
    bump(qtyEl);
  });
});

document.querySelectorAll('.opt-minus').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const key = btn.dataset.opt;
    const qtyEl = document.querySelector(`.opt-qty[data-opt="${key}"]`);
    qtyEl.textContent = Math.max(0, parseInt(qtyEl.textContent) - 1);
    bump(qtyEl);
  });
});
function collectOptions(){
  const opts=[];
  const optionKeys = ['sojaSucree','sojaSalee','wasabi','gingembre'];
  optionKeys.forEach(key=>{
    const qty = parseInt(document.querySelector(`.opt-qty[data-opt="${key}"]`).textContent)||0;
    if(qty>0){
      const label = key.replace('sojaSucree','Soja sucrée')
                       .replace('sojaSalee','Soja salée')
                       .replace('wasabi','Wasabi')
                       .replace('gingembre','Gingembre');
      opts.push(`${label} x${qty}`);
    }
  });
  const bag = parseInt(bagQty.textContent)||0;
  return {opts, bag};
}

   
  /* ===================== Tiroir récap & envoi (inchangé) ===================== */
  // … garde ton code existant pour le tiroir, prepareOrderText, fetch Formspree, etc.
  document.getElementById('ctaOrder').onclick = ()=> document.getElementById('menuSection').scrollIntoView({behavior:'smooth'});
  updateSticky();
</script>
</body>
</html>
