<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YUMEKO SUSHIS</title>
  <style>
    :root{
      --brand:#8b0000; --brand-2:#a31212; --text:#f8f8f8;
      --card:#1b1b1b; --muted:#cfcfcf; --accent:#ffb6b6; --accent-2:#ff8c8c;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(180deg, #0f0f0f 0%, #8b0000 100%); color:var(--text); min-height:100vh;
    }
    .hero{
      position:relative; isolation:isolate;
      background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.75)), url('images/hero.jpg') center/cover no-repeat;
      padding: clamp(32px, 6vw, 72px) 20px; text-align:left; overflow:hidden;
    }
    .hero-inner{ max-width:1100px; margin:0 auto; display:grid; grid-template-columns:1.1fr .9fr; gap:24px; align-items:center; }
    .logo-mark{ display:flex; align-items:center; gap:14px; }
    .logo-mark img{ width:56px; height:56px; object-fit:contain; }
    h1.brand{ font-size:clamp(28px,4vw,48px); margin:8px 0 6px; letter-spacing:.08em; font-weight:800; }
    .hero p{ color:var(--muted); margin:6px 0 18px; font-size:clamp(14px,1.4vw,18px); }
    .cta{ background:var(--brand); border:none; color:#fff; padding:14px 18px; border-radius:10px; font-weight:800; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.25); }
    .cta:hover{ background:var(--brand-2); }

    .container{ max-width:1100px; margin:0 auto; padding:22px; }
    .section{ background:#160c0c; border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:clamp(16px,2vw,26px); box-shadow:0 10px 30px rgba(0,0,0,.25); }
    .section-title{ font-size:clamp(22px,2.4vw,32px); margin:0 0 14px; color:#fff; }

    .category{ margin-top:18px; }
    .category h3{ display:flex; align-items:center; justify-content:space-between; margin:0 0 10px; font-size:clamp(18px,2vw,22px); color:#ffe1e1; border-bottom:1px dashed rgba(255,255,255,.1); padding-bottom:6px; }

    .menu-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
    @media (max-width:820px){ .hero-inner{ grid-template-columns:1fr; text-align:center; } .logo-mark{ justify-content:center; } .menu-grid{ grid-template-columns:1fr; } }

    .item-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .left{ display:flex; align-items:center; gap:12px; min-width:0; }
    .thumb{ width:64px; height:64px; border-radius:10px; object-fit:cover; box-shadow:0 0 8px rgba(0,0,0,.35); background:#0d0d0d; }
    .item-lines{ min-width:0; }
    .item-name{ font-weight:700; line-height:1.1; }
    .item-sub{ color:var(--muted); font-size:12px; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .controls{ display:flex; align-items:center; gap:10px; flex-shrink:0; }
    .price{ font-weight:800; color:#fff; margin-right:8px; }

    .btn{ background:var(--accent); color:#111; border:none; width:38px; height:38px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; font-weight:900; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,.35); transition:transform .1s ease, background .2s ease; }
    .btn:hover{ background:var(--accent-2); transform:scale(1.06); }
    .btn:active{ transform:scale(.95); }
    .qty{ min-width:28px; text-align:center; font-weight:800; }
    .qty.bump{ transform:scale(1.18); transition:transform .2s ease; }

    form input[type="text"], form input[type="tel"], form input[type="date"], form input[type="time"], form textarea{
      width:min(560px,92%); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background:#161616; color:#fff;
    }
    form textarea{ min-height:96px; resize:vertical; }
    form .options{ color:#eee; font-size:14px; margin: 8px 0 0; }
    .schedule small{ color:#c9c9c9; opacity:.85; display:block; margin-top:6px; }

    #stickyBar{ position:fixed; left:0; right:0; bottom:0; z-index:60; display:block; background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.4)); }
    #stickyInner{ margin:0 auto 12px; width:min(96%,1100px); }
    #gotoOrder{ width:100%; background:var(--brand); color:white; font-weight:900; border:none; border-radius:12px; padding:14px 18px; cursor:pointer; }

    footer{ text-align:center; color:#d7d7d7; opacity:.9; margin:60px 0 110px; }

    /* ===== MODAL Panier / R√©cap ===== */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(2px); display:none; z-index: 80; }
    .modal{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:min(560px, 92%); background:#1b1b1b; color:#fff; border:1px solid rgba(255,255,255,.12); border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.5); padding:14px; display:none; z-index: 81; }
    .modal.open, .modal-backdrop.open{ display:block; }
    .modal header{ display:flex; align-items:center; justify-content:space-between; padding:6px 6px 10px; border-bottom:1px solid rgba(255,255,255,.08); }
    .modal h3{ margin:0; font-size:18px; }
    .modal .close{ background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer; line-height:1; }
    .modal .body{ max-height: 56vh; overflow:auto; padding: 10px 4px; }
    .recap-list{ list-style:none; padding:0; margin:0; }
    .recap-list li{ display:flex; justify-content:space-between; padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,.08); }
    .muted{ color:#cfcfcf; opacity:.9; font-size:14px; }
    .modal footer{ display:flex; gap:10px; justify-content:flex-end; padding-top:10px; border-top:1px solid rgba(255,255,255,.08); }
    .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.25); color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; }
    .btn-primary{ background:var(--brand); border:none; color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:800; }
    .btn-primary:hover{ background:var(--brand-2); }
    .shake { animation: shake .35s linear; }
    @keyframes shake { 0%,100%{ transform: translateX(0); } 25%{ transform: translateX(-4px); } 50%{ transform: translateX(4px); } 75%{ transform: translateX(-2px); } }
  </style>
</head>
<body>
  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div>
        <div class="logo-mark">
          <img src="logo-yumeko.png" alt="YUMEKO SUSHIS" />
          <h1 class="brand">YUMEKO SUSHIS</h1>
        </div>
        <p>Des sushis frais et gourmands qui font ronronner vos papilles. Commande en ligne et r√©cup√®re facilement ta box ‚ú®</p>
        <button class="cta" id="ctaOrder">COMMANDER MAINTENANT</button>
      </div>
      <div></div>
    </div>
  </section>

  <main class="container">
    <!-- MENU -->
    <section class="section" id="menuSection">
      <h2 class="section-title">Menu</h2>
      <div id="menu"></div>
    </section>

    <!-- FORM COMMANDE -->
    <section class="section" id="orderSection" style="margin-top:18px; text-align:center;">
      <h2 class="section-title">Validez votre commande</h2>
      <form id="orderForm" action="https://formspree.io/f/xblzvgjr" method="POST">
        <p><input type="text" name="name" id="clientName" placeholder="Votre pr√©nom" required></p>
        <p><input type="tel" name="phone" id="clientPhone" placeholder="T√©l√©phone (optionnel)"></p>

        <!-- Options -->
        <p class="options">
          <label><input type="checkbox" id="optSojaSucree" name="soja_sucree"> Soja sucr√©e</label>
          <label style="margin-left:12px"><input type="checkbox" id="optSojaSalee" name="soja_salee"> Soja sal√©e</label>
          <label style="margin-left:12px"><input type="checkbox" id="optWasabi" name="wasabi"> Wasabi</label>
          <label style="margin-left:12px"><input type="checkbox" id="optGingembre" name="gingembre"> Gingembre</label>
        </p>

        <!-- Baguettes -->
        <div class="options" style="margin-top:10px;">
          <span style="display:block;margin-bottom:6px">Baguettes :</span>
          <button class="btn" type="button" id="bagMinus" aria-label="Retirer 1">‚àí</button>
          <span class="qty" id="bagQty">1</span>
          <button class="btn" type="button" id="bagPlus" aria-label="Ajouter 1">+</button>
          <input type="hidden" name="baguettes" id="bagInput" value="1" />
        </div>

        <!-- üìÖ Date & heure (FACULTATIF) -->
        <div class="options schedule" style="margin-top:14px;">
          <span style="display:block;margin-bottom:6px">Date et heure de retrait (facultatif) :</span>
          <p style="margin:8px 0;"><input type="date" name="pickup_date" id="pickupDate"></p>
          <p style="margin:8px 0;"><input type="time" name="pickup_time" id="pickupTime" step="900"></p>
          <small>Heures de service recommand√©es : 11:30 ‚Äì 21:30</small>
        </div>

        <!-- üí¨ Commentaire -->
        <p style="margin-top:14px;">
          <textarea name="comments" id="comments" placeholder="Commentaire (allergies, sauce en plus, heure pr√©cise, etc.)"></textarea>
        </p>

        <textarea name="order" id="orderText" hidden></textarea>
        <p><button class="cta" type="submit" style="margin-top:12px;">Envoyer ma commande üç£</button></p>
        <div id="orderResult" style="margin-top:8px; font-size:14px; color:#e6e6e6;"></div>
      </form>
    </section>
  </main>

  <!-- Sticky cart button -->
  <div id="stickyBar" aria-live="polite">
    <div id="stickyInner">
      <button id="gotoOrder">Panier (0) ‚Ä¢ Valider</button>
    </div>
  </div>

  <!-- MODAL: R√©cap commande -->
  <div class="modal-backdrop" id="modalBack"></div>
  <div class="modal" id="cartModal" role="dialog" aria-modal="true" aria-labelledby="recapTitle">
    <header>
      <h3 id="recapTitle">Valider votre commande</h3>
      <button class="close" id="closeModal" aria-label="Fermer">√ó</button>
    </header>
    <div class="body">
      <p class="muted" id="modalIntro">V√©rifie ton panier avant l‚Äôenvoi :</p>
      <ul class="recap-list" id="recapList"></ul>
      <div id="recapOptions"></div>
      <div id="recapPickup" class="muted" style="margin-top:8px;"></div>
      <div id="recapComment" class="muted" style="margin-top:4px;"></div>
    </div>
    <footer>
      <button class="btn-ghost" id="editOrder">Modifier</button>
      <button class="btn-primary" id="confirmSend">Confirmer et envoyer</button>
    </footer>
  </div>

  <footer>¬© 2025 YUMEKO SUSHIS ‚Äî Les sushis qui font ronronner vos papilles </footer>

<script>
/* ===================== DATA ===================== */
const categories = {
  'Maki 4 pi√®ces': ['M1- Saumon','M2- Saumon/Avocat','M3- Saumon/Cheese','M4- Thon','M5- Concombre','M6- Concombre/Cheese','M7- Avocat','M8- Avocat/Cheese'],
  'California 4 pi√®ces': ['C1- Saumon','C2- Saumon/Avocat','C3- Saumon/Cheese','C4- Thon','C5- Concombre','C6- Concombre/Cheese','C7- Avocat','C8- Avocat/Cheese'],
  'Maki printemps 4 pi√®ces': ['P1- Saumon/Avocat','P2- Saumon/Cheese','P3- Concombre/Cheese','P4- Avocat/Cheese'],
  'Signature 4 pi√®ces': ['S1- California Saumon/Cheese/Oignons frits','S2- Rols Saumon/Avocat/Cheese'],
  'Sashimi 2 pi√®ces': ['Saumon'],
  'Nigiri 2 pi√®ces': ['N1- Saumon','N2- Avocat']
};
const prices = {}; // si tu veux afficher des prix, remplis ce mapping

/* ===================== RENDU MENU (1x) ===================== */
function buildMenu(){
  const menu = document.getElementById('menu');
  for(const [cat, items] of Object.entries(categories)){
    const wrap = document.createElement('div');
    wrap.className = 'category';
    wrap.innerHTML = `<h3>${cat}</h3><div class="menu-grid"></div>`;
    const grid = wrap.querySelector('.menu-grid');

    items.forEach(item=>{
      const code = item.split('-')[0].trim();
      const nameOnly = item.split('-').slice(1).join('-').trim();
      const price = prices[code];

      const card = document.createElement('div');
      card.className = 'item-card';
      card.innerHTML = `
        <div class="left">
          <img class="thumb" src="images/${code.toLowerCase()}.jpg" alt="${item}" onerror="this.style.display='none'"/>
          <div class="item-lines">
            <div class="item-name">${nameOnly || item}</div>
            <div class="item-sub">${cat}</div>
          </div>
        </div>
        <div class="controls">
          ${price !== undefined ? `<span class="price">${price.toFixed(2)}‚Ç¨</span>` : ''}
          <button class="btn minus" data-item="${item}" aria-label="Retirer 1">‚àí</button>
          <span class="qty" data-item="${item}">0</span>
          <button class="btn plus" data-item="${item}" aria-label="Ajouter 1">+</button>
        </div>`;
      grid.appendChild(card);
    });

    menu.appendChild(wrap);
  }
}
buildMenu();

/* ===================== INTERACTIONS ===================== */
function bumpAnimation(el){ el.classList.add('bump'); setTimeout(()=>el.classList.remove('bump'), 200); }
function getTotal(){ let t=0; document.querySelectorAll('.qty[data-item]').forEach(q=>t+=parseInt(q.textContent)||0); return t; }
function updateSticky(){ const t=getTotal(); document.getElementById('gotoOrder').textContent = `Panier (${t}) ‚Ä¢ Valider`; }

document.addEventListener('click', (e)=>{
  if(e.target.classList.contains('plus')){
    const item=e.target.dataset.item; const span=document.querySelector(`.qty[data-item="${item}"]`);
    span.textContent = (parseInt(span.textContent)||0) + 1; bumpAnimation(span); updateSticky();
  }
  if(e.target.classList.contains('minus')){
    const item=e.target.dataset.item; const span=document.querySelector(`.qty[data-item="${item}"]`);
    span.textContent = Math.max(0,(parseInt(span.textContent)||0) - 1); bumpAnimation(span); updateSticky();
  }
});

// Baguettes
const bagMinus = document.getElementById('bagMinus');
const bagPlus  = document.getElementById('bagPlus');
const bagQty   = document.getElementById('bagQty');
const bagInput = document.getElementById('bagInput');
bagMinus.addEventListener('click', ()=>{ const v=Math.max(0,(parseInt(bagQty.textContent)||0)-1); bagQty.textContent=v; bagInput.value=v; bumpAnimation(bagQty); });
bagPlus.addEventListener('click', ()=>{ const v=(parseInt(bagQty.textContent)||0)+1; bagQty.textContent=v; bagInput.value=v; bumpAnimation(bagQty); });

/* ===================== MODAL PANIER ===================== */
const gotoOrderBtn = document.getElementById('gotoOrder');
const modal = document.getElementById('cartModal');
const backdrop = document.getElementById('modalBack');
const closeModal = ()=>{ modal.classList.remove('open'); backdrop.classList.remove('open'); }
document.getElementById('closeModal').onclick = closeModal;
document.getElementById('editOrder').onclick = closeModal;
backdrop.onclick = closeModal;

function collectItems(){
  const lines = [];
  document.querySelectorAll('.qty[data-item]').forEach(span=>{
    const q = parseInt(span.textContent)||0;
    if(q>0) lines.push({ label: span.dataset.item, qty: q });
  });
  return lines;
}
function collectOptions(){
  const opts = [];
  if(document.getElementById('optSojaSucree').checked) opts.push('Soja sucr√©e');
  if(document.getElementById('optSojaSalee').checked)  opts.push('Soja sal√©e');
  if(document.getElementById('optWasabi').checked)     opts.push('Wasabi');
  if(document.getElementById('optGingembre').checked)  opts.push('Gingembre');
  const bag = parseInt(document.getElementById('bagQty').textContent)||0;
  return { opts, bag };
}
function buildRecap(){
  const list = document.getElementById('recapList');
  list.innerHTML = '';
  const items = collectItems();
  if(items.length===0){
    list.innerHTML = '<li class="muted">Ton panier est vide.</li>';
  }else{
    items.forEach(it=>{
      const li = document.createElement('li');
      li.innerHTML = `<span>${it.label}</span><strong>x${it.qty}</strong>`;
      list.appendChild(li);
    });
  }
  const {opts, bag} = collectOptions();
  const recOpt = document.getElementById('recapOptions');
  const optParts = [];
  if(opts.length) optParts.push(`Options: ${opts.join(', ')}`);
  if(bag>0) optParts.push(`Baguettes x${bag}`);
  recOpt.innerHTML = optParts.length ? `<p class="muted">${optParts.join(' ‚Ä¢ ')}</p>` : '';

  const d = document.getElementById('pickupDate').value;
  const t = document.getElementById('pickupTime').value;
  document.getElementById('recapPickup').textContent = (d||t) ? `Retrait: ${d||''} ${t||''}` : '';
  const c = (document.getElementById('comments').value||'').trim();
  document.getElementById('recapComment').textContent = c ? `Commentaire: ${c}` : '';
}

gotoOrderBtn.addEventListener('click', ()=>{
  const total = getTotal();
  if(total===0){
    gotoOrderBtn.classList.add('shake');
    setTimeout(()=>gotoOrderBtn.classList.remove('shake'), 400);
    return;
  }
  buildRecap();
  modal.classList.add('open');
  backdrop.classList.add('open');
});

/* ===================== ENVOI FORMSPREE ===================== */
const dateInput = document.getElementById('pickupDate');
const timeInput = document.getElementById('pickupTime');

const form = document.getElementById('orderForm');
function prepareOrderText(){
  const items = collectItems();
  if(items.length===0){
    const r=document.getElementById('orderResult');
    r.textContent="Ajoute au moins un article avant d'envoyer üòä";
    r.style.color="#ffd4d4";
    return false;
  }
  const lines = items.map(it=>`${it.label} x${it.qty}`);
  const {opts, bag} = collectOptions();
  if(opts.length) lines.push(`Options: ${opts.join(', ')}`);
  if(bag>0) lines.push(`Baguettes x${bag}`);
  const d = dateInput.value; const t = timeInput.value;
  const c = (document.getElementById('comments').value||'').trim();
  if(d||t) lines.push(`Retrait: ${d||''} ${t||''}`);
  if(c) lines.push(`Commentaire: ${c}`);
  document.getElementById('orderText').value = lines.join('\n');
  return true;
}

document.getElementById('confirmSend').addEventListener('click', ()=>{
  if(prepareOrderText()){
    closeModal();
    if(form.requestSubmit){ form.requestSubmit(); } else { form.submit(); } // iOS old fallback
  }
});

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  // si l‚Äôutilisateur clique ¬´ Envoyer ¬ª direct, sans modal
  if(!document.getElementById('orderText').value){
    if(!prepareOrderText()) return;
  }
  try{
    const resp = await fetch(form.action,{method:'POST', headers:{'Accept':'application/json'}, body:new FormData(form)});
    const r=document.getElementById('orderResult');
    if(resp.ok){
      r.textContent='Merci ! Ta commande a bien √©t√© envoy√©e üç£';
      r.style.color='#b7ffb7';
      document.querySelectorAll('.qty').forEach(s=>s.textContent='0');
      form.reset(); bagQty.textContent='1'; bagInput.value='1'; updateSticky();
    } else {
      r.textContent="Oups, l'envoi a √©chou√©. R√©essaie üôè";
      r.style.color='#ffd4d4';
    }
  }catch{
    const r=document.getElementById('orderResult');
    r.textContent='Erreur r√©seau. R√©essaie.';
    r.style.color='#ffd4d4';
  }
});

/* ===================== SCROLL + INIT ===================== */
document.getElementById('ctaOrder').addEventListener('click', ()=> document.getElementById('menuSection').scrollIntoView({behavior:'smooth'}));
updateSticky();
</script>
</body>
</html>
