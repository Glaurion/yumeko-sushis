<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YUMEKO SUSHIS</title>

  <style>
    :root{
      /* Couleurs du th√®me */
      --brand:#8b0000;          /* rouge fonc√© */
      --brand-2:#a31212;        /* rouge hover */
      --text:#f8f8f8;
      --card:#1b1b1b;
      --muted:#cfcfcf;
      --accent:#ffb6b6;
      --accent-2:#ff8c8c;

      /* Opacit√© du d√©grad√© du bandeau (mise √† jour au scroll via JS) */
      --barShade: .35;
    }

    /* On retire totalement la section de la page (on g√®re tout dans le tiroir) */
    #orderSection { display: none !important; }

    *{ box-sizing: border-box; }

    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(180deg, #0f0f0f 0%, #8b0000 100%);
      color:var(--text); min-height:100vh;
    }

    /* HERO */
    .hero{
      background:linear-gradient(to bottom,rgba(0,0,0,.55),rgba(0,0,0,.75)),url('images/hero.jpg') center/cover no-repeat;
      padding:60px 20px; text-align:center;
    }
    h1.brand{ font-size:2.5rem; margin:10px 0; letter-spacing:2px; font-weight:800; }
    .cta{ background:var(--brand); border:none; color:#fff; padding:14px 18px; border-radius:10px; font-weight:800; cursor:pointer; }
    .cta:hover{ background:var(--brand-2); }

    /* LAYOUT & SECTIONS */
    .container{ max-width:1100px; margin:0 auto; padding:20px; }
    .section{ background:#160c0c; border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.25); margin-bottom:25px;}
    .section-title{ color:#fff; font-size:1.8rem; margin-bottom:10px; }

    /* MENU */
    .menu-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:12px; }
    .item-card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .left{ display:flex; align-items:center; gap:10px; min-width:0; }
    .thumb{ width:60px; height:60px; border-radius:10px; object-fit:cover; background:#0d0d0d; box-shadow:0 0 8px rgba(0,0,0,.35); }
    .thumb.sm{ width:44px; height:44px; border-radius:8px; }
    .item-name{ font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .controls{ display:flex; align-items:center; gap:8px; }
    .btn{ background:var(--accent); border:none; color:#111; width:34px; height:34px; border-radius:50%; font-weight:900; cursor:pointer; transition:transform .15s; }
    .btn:hover{ background:var(--accent-2); transform:scale(1.1); }
    .qty{ min-width:22px; text-align:center; font-weight:800; }
    .qty.bump{ transform:scale(1.15); transition:transform .2s; }

    /* FORM */
    form input, form textarea{ width:90%; max-width:520px; background:#161616; color:#fff; border:1px solid rgba(255,255,255,.2); border-radius:10px; padding:10px; margin:6px auto; display:block; }
    textarea{ resize:vertical; min-height:90px; }
    .muted{ color:#cfcfcf; opacity:.95; font-size:14px; }

    /* STICKY BAR */
    #stickyBar{
      position:fixed; bottom:0; left:0; right:0; z-index:100;
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,var(--barShade)));
      padding:10px;
    }
    #stickyInner{ width:min(96%,1100px); margin:0 auto; display:flex; flex-direction:column; gap:8px; }
    #miniRecap{ font-size:13px; color:#eee; opacity:.95; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    #miniRecap::-webkit-scrollbar{ display:none; }
    #gotoOrder{ width:100%; background:var(--brand); color:#fff; font-weight:900; border:none; border-radius:12px; padding:14px; cursor:pointer; }

    /* TIROIR R√âCAP */
    #cartSheet{
      position:fixed; left:50%; transform:translateX(-50%); bottom:-100%;
      width:min(96%,1100px); background:#1b1b1b; color:#fff;
      border:1px solid rgba(255,255,255,.12); border-radius:16px 16px 0 0;
      box-shadow:0 22px 60px rgba(0,0,0,.45); max-height:70vh;
      display:flex; flex-direction:column; transition:bottom .28s ease; z-index:101;
    }
    #cartSheet.open{ bottom:62px; }
    #cartSheet header, #cartSheet footer{ padding:10px 12px; display:flex; align-items:center; justify-content:space-between; }
    #cartSheet header{ border-bottom:1px solid rgba(255,255,255,.1); }
    #cartSheet footer{ border-top:1px solid rgba(255,255,255,.1); gap:10px; justify-content:flex-end; }
    #cartSheet header h3{ margin:0; font-size:18px; }
    #cartSheet header button{ background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer; }
    #cartSheet .body{ padding:10px; overflow:auto; }
    .recap-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
    .recap-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 6px; border-bottom:1px dashed rgba(255,255,255,.1); }
    .recap-item .it-left{ display:flex; align-items:center; gap:10px; min-width:0; flex:1; }
    .recap-item .it-label{ flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .recap-item .it-ctrl{ display:flex; align-items:center; gap:8px; }

    /* Boutons du tiroir */
    .btn-ghost, .btn-primary{
      border:none; border-radius:12px; padding:12px 16px; font-weight:900; cursor:pointer;
    }
    .btn-ghost{ background:#2a2a2a; color:#fff; }
    .btn-ghost:hover{ filter:brightness(1.1); }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-primary:hover{ background:var(--brand-2); }

    footer{ text-align:center; color:#d7d7d7; margin:60px 0 120px; }
    .shake{ animation:shake .35s; } 
    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-4px);}50%{transform:translateX(4px);}75%{transform:translateX(-2px);} }

    /* Stepper du tiroir */
    .step{ display:none; }
    .step.active{ display:block; }
    .hr{ border-top:1px solid rgba(255,255,255,.08); margin:10px 0; }
  </style>
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link rel="apple-touch-icon" href="images/favicon.png" />
  <meta name="theme-color" content="#8b0000" />
</head>
<body>

  <!-- HERO -->
  <section class="hero">
    <img src="images/logo-yumeko.png" alt="YUMEKO SUSHIS" width="120" style="border-radius:50%;box-shadow:0 0 10px rgba(0,0,0,.3)">
    <h1 class="brand">üç£ YUMEKO SUSHIS üç£</h1>
    <p>Commandez vos sushis pr√©f√©r√©s simplement ici üç±</p>
    <button class="cta" id="ctaOrder">Commander maintenant</button>
  </section>

  <main class="container">
    <!-- MENU -->
    <section class="section" id="menuSection">
      <h2 class="section-title">Menu</h2>
      <div id="menu"></div>
    </section>

    <!-- FORM COMMANDE (sera d√©plac√© dans le tiroir) -->
    <section class="section" id="orderSection" style="text-align:center;">
      <h2 class="section-title">Validez votre commande</h2>
      <form id="orderForm" action="https://formspree.io/f/xblzvgjr" method="POST">
        <input name="first_name" placeholder="Pr√©nom" required>
        <input name="last_name" placeholder="Nom" required>
        <!-- T√©l√©phone devient OBLIGATOIRE -->
        <input name="phone" type="tel" placeholder="T√©l√©phone" required inputmode="tel" pattern="^\+?[0-9][0-9 .\-]{7,14}$" title="Num√©ro de t√©l√©phone (ex: 0601020304 ou +33 6 01 02 03 04)">

        <p class="muted" style="margin-top:8px">Options :</p>
        <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-bottom:10px;">
          <div>
            <span class="muted">Soja sucr√©e :</span><br>
            <button type="button" class="btn opt-minus" data-opt="sojaSucree">‚àí</button>
            <span class="qty opt-qty" data-opt="sojaSucree">0</span>
            <button type="button" class="btn opt-plus" data-opt="sojaSucree">+</button>
          </div>
          <div>
            <span class="muted">Soja sal√©e :</span><br>
            <button type="button" class="btn opt-minus" data-opt="sojaSalee">‚àí</button>
            <span class="qty opt-qty" data-opt="sojaSalee">0</span>
            <button type="button" class="btn opt-plus" data-opt="sojaSalee">+</button>
          </div>
          <div>
            <span class="muted">Wasabi :</span><br>
            <button type="button" class="btn opt-minus" data-opt="wasabi">‚àí</button>
            <span class="qty opt-qty" data-opt="wasabi">0</span>
            <button type="button" class="btn opt-plus" data-opt="wasabi">+</button>
          </div>
          <div>
            <span class="muted">Gingembre :</span><br>
            <button type="button" class="btn opt-minus" data-opt="gingembre">‚àí</button>
            <span class="qty opt-qty" data-opt="gingembre">0</span>
            <button type="button" class="btn opt-plus" data-opt="gingembre">+</button>
          </div>
        </div>

        <div style="margin:8px 0 12px">
          <span class="muted" style="display:block;margin-bottom:6px;">Baguettes :</span>
          <button type="button" class="btn" id="bagMinus">‚àí</button>
          <span class="qty" id="bagQty">1</span>
          <button type="button" class="btn" id="bagPlus">+</button>
          <input type="hidden" name="baguettes" id="bagInput" value="1">
        </div>

        <p class="muted" style="margin:8px 0 4px">Date & heure de livraison (facultatif)</p>
        <input type="date" id="deliveryDate" name="delivery_date">
        <input type="time" id="deliveryTime" name="delivery_time" step="900">

        <textarea name="comments" id="comments" placeholder="Commentaire (allergies ou autres)"></textarea>

        <!-- BOUTON D'ENVOI SUPPRIM√â (on utilise celui du tiroir) -->
        <div id="orderResult" style="margin-top:8px;font-size:14px;"></div>
      </form>
    </section>
  </main>

  <!-- BANDEAU PANIER -->
  <div id="stickyBar" aria-live="polite">
    <div id="stickyInner">
      <span id="miniRecap"></span>
      <button id="gotoOrder">Panier (0) ‚Ä¢ Valider</button>
    </div>
  </div>

  <!-- TIROIR R√âCAP / 2 √âTAPES -->
  <div id="cartSheet" aria-hidden="true">
    <header>
      <h3>Valider votre commande</h3>
      <button id="sheetClose" aria-label="Fermer">√ó</button>
    </header>
    <div class="body">
      <!-- √âTAPE 1 : R√©cap & √©dition -->
      <div id="stepCart" class="step active">
        <p class="muted" id="sheetIntro">V√©rifie ton panier et ajuste les quantit√©s :</p>
        <ul class="recap-list" id="recapList"></ul>
        <div id="recapOptions" style="margin-top:6px;"></div>
        <div id="recapPickup" class="muted" style="margin-top:6px;"></div>
        <div id="recapComment" class="muted" style="margin-top:4px;"></div>
      <div id="recapTotal" style="margin-top:10px;font-weight:800;text-align:right"></div>
      $1
      <div id="stepDetails" class="step">
        <!-- le formulaire sera inject√© ici par JS -->
      </div>
    </div>
    <footer>
      <div id="footerCart" class="step active">
        <!-- Bouton "Modifier le menu" SUPPRIM√â -->
        <button class="btn-primary" id="goDetails">Valider le panier ‚Üí</button>
      </div>
      <div id="footerDetails" class="step">
        <button class="btn-ghost" id="backToCart">‚Üê Retour</button>
        <button class="btn-primary" id="confirmSend">Confirmer et envoyer</button>
      </div>
    </footer>
  </div>

  <footer>¬© 2025 YUMEKO SUSHIS ‚Äî Les sushis qui font ronronner vos papilles</footer>

  <!-- Script 1 : Gestion du tiroir / formulaire (ouvre m√™me vide) -->
  <script>
  /* ======== PANIER am√©lior√© : r√©cap editable + page infos ======== */
  document.addEventListener('DOMContentLoaded', function () {
    const sheet       = document.getElementById('cartSheet');
    const sheetBody   = sheet?.querySelector('.body');
    const sheetClose  = document.getElementById('sheetClose');
    const btnOpen     = document.getElementById('gotoOrder');
    const btnGoDetails= document.getElementById('goDetails');
    const btnBack     = document.getElementById('backToCart');
    const btnConfirm  = document.getElementById('confirmSend');
    const recapList   = document.getElementById('recapList');
    const recapOpt    = document.getElementById('recapOptions');
    const recapPickup = document.getElementById('recapPickup');
    const recapCom    = document.getElementById('recapComment');
    const form        = document.getElementById('orderForm');
    const orderResult = document.getElementById('orderResult');
    const stepCart    = document.getElementById('stepCart');
    const stepDetails = document.getElementById('stepDetails');
    const footCart    = document.getElementById('footerCart');
    const footDetails = document.getElementById('footerDetails');
    if (!sheet || !sheetBody || !btnOpen || !recapList || !recapOpt || !recapPickup || !recapCom) {
      console.warn('[cart] √©l√©ments requis manquants');
      return;
    }

    // D√©placer le formulaire dans l'√©tape 2 du tiroir
    if (form && !stepDetails.contains(form)) stepDetails.appendChild(form);

    // ---- Utilitaires globaux s√ªrs ----
    function safeInt(el){ return Math.max(0, parseInt(el?.textContent ?? '0') || 0); }

    // Fallback si collectOptions n‚Äôexiste pas (au cas o√π le code amont change)
    function collectOptionsSafe(){
      if (typeof collectOptions === 'function') return collectOptions();
      const bagQtyEl = document.getElementById('bagQty');
      const bag = safeInt(bagQtyEl);
      const map = [
        ['sojaSucree','Soja sucr√©e'],
        ['sojaSalee','Soja sal√©e'],
        ['wasabi','Wasabi'],
        ['gingembre','Gingembre']
      ];
      const opts=[];
      map.forEach(([key,label])=>{
        const qty = safeInt(document.querySelector(`.opt-qty[data-opt="${key}"]`));
        if (qty>0) opts.push(`${label} x${qty}`);
      });
      return { opts, bag };
    }

    // R√©cup√®re items du menu avec code+nom nettoy√© (sans suffixe type "M9-")
    function parseItem(full){
      const code = (full.split('-')[0] || '').trim();
      const name = full.split('-').slice(1).join('-').trim() || full.trim();
      return {code, name};
    }

    function getCartItems(){
      const map = new Map(); // key: code, value: {code, name, qty}
      document.querySelectorAll('.qty[data-item]').forEach(span=>{
        const q = Math.max(0, parseInt(span.textContent)||0);
        if (q>0){
          const full = span.dataset.item;
          const code = (full.split('-')[0]||'').trim();
          const name = full.split('-').slice(1).join('-').trim() || full.trim();
          const prev = map.get(code) || {code, name, qty:0};
          prev.qty += q;
          map.set(code, prev);
        }
      });
      return Array.from(map.values());
    } = parseItem(full);
          items.push({ code, name, qty });
        }
      });
      return items;
    }

    function buildRecap(){
      const items = getCartItems();
      recapList.innerHTML = '';
      let total = 0;
      if (items.length === 0) {
        recapList.innerHTML = '<li class="muted">Aucun article pour le moment.</li>';
      } else {
        items.forEach(({code, name, qty})=>{
          const li = document.createElement('li');
          li.className = 'recap-item';
          const codeLower = (code||'').toLowerCase();
          const price = prices[code];
          const line = (typeof price === 'number') ? (price * qty) : 0;
          if (typeof price === 'number') total += line;
          li.innerHTML = `
            <div class="it-left">
              <img class="thumb sm" src="images/${codeLower}.jpg" alt="${name}" onerror="this.style.display='none'">
              <span class="it-label">${name}${typeof price==='number' ? ` ‚Äî ${price.toFixed(2)}‚Ç¨` : ''}</span>
            </div>
            <div class="it-ctrl">
              <button class="btn recap-minus" data-item="${code}- ${name}" aria-label="Retirer">‚àí</button>
              <span class="qty" aria-live="polite">${qty}</span>
              <button class="btn recap-plus" data-item="${code}- ${name}" aria-label="Ajouter">+</button>
            </div>`;
          recapList.appendChild(li);
        });
      }

      // Options (soja, wasabi, gingembre + baguettes)
      const {opts, bag} = collectOptionsSafe();
      const parts = [];
      if (opts.length) parts.push(opts.join(' ‚Ä¢ '));
      parts.push(`Baguettes x${bag}`);
      recapOpt.textContent = parts.join(' ‚Äî ');

      // Livraison (date/heure)
      const d = document.getElementById('deliveryDate')?.value || '';
      const t = document.getElementById('deliveryTime')?.value || '';
      recapPickup.textContent = (d || t) ? `Livraison : ${[d,t].filter(Boolean).join(' √† ')}` : '';

      // Commentaire
      const c = document.getElementById('comments')?.value?.trim() || '';
      recapCom.textContent = c ? `Commentaire : ${c}` : '';

      // Total
      const recapTotal = document.getElementById('recapTotal');
      if (recapTotal) recapTotal.textContent = `Total : ${total.toFixed(2)}‚Ç¨`;
    }

    function openSheet(){
      setStep('cart');
      buildRecap();
      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
    }(){
      setStep('cart');
      buildRecap();
      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
    }
    function closeSheet(){
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden','true');
    }

    function setStep(which){
      const cartActive = which === 'cart';
      stepCart.classList.toggle('active', cartActive);
      footCart.classList.toggle('active', cartActive);
      stepDetails.classList.toggle('active', !cartActive);
      footDetails.classList.toggle('active', !cartActive);
    }

    btnOpen.addEventListener('click', openSheet);
    sheetClose?.addEventListener('click', closeSheet);

    // Navigation √©tapes
    btnGoDetails?.addEventListener('click', ()=> setStep('details'));
    btnBack?.addEventListener('click', ()=> setStep('cart'));

    // √âchap pour fermer
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && sheet.classList.contains('open')) closeSheet();
    });

    // Pr√©parer le texte d‚Äôordre pour Formspree (champ cach√© "order")
    function ensureHiddenField(name){
      if (!form) return null;
      let input = form.querySelector(`input[name="${name}"]`);
      if (!input) {
        input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        form.appendChild(input);
      }
      return input;
    }

    function prepareOrderText(){
      const itemsText = getCartItems()
        .map(({name, qty})=>`- ${name} x${qty}`)
        .join('\n');
      const {opts, bag} = collectOptionsSafe();
      const d = document.getElementById('deliveryDate')?.value || '‚Äî';
      const t = document.getElementById('deliveryTime')?.value || '‚Äî';
      const c = document.getElementById('comments')?.value?.trim() || '‚Äî';
      const first = form?.querySelector('[name="first_name"]')?.value || '‚Äî';
      const last  = form?.querySelector('[name="last_name"]')?.value || '‚Äî';
      const phone = form?.querySelector('[name="phone"]')?.value || '‚Äî';

      const text =
`Commande YUMEKO
Client : ${first} ${last}
T√©l√©phone : ${phone}

Articles :
${itemsText || '(aucun)'}

Options : ${opts.length ? opts.join(', ') : 'aucune'}
Baguettes : ${bag}

Livraison : ${d} ${t}
Commentaire : ${c}`;

      const hidden = ensureHiddenField('order');
      if (hidden) hidden.value = text;
    }

    // Envoi : le bouton du tiroir d√©clenche l‚Äôenvoi du formulaire
    btnConfirm?.addEventListener('click', ()=>{
      if (!form) return;
      // V√©rifier les champs requis. Si invalide, basculer vers l'√©tape d√©tails.
      if (!form.reportValidity()) {
        setStep('details');
        form.reportValidity();
        form.querySelector(':invalid')?.focus();
        return;
      }
      prepareOrderText();
      form.requestSubmit(); // d√©clenche la soumission native
    });

    // Soumission via fetch pour afficher un retour dans le tiroir
    if (form) {
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if (orderResult) orderResult.textContent = 'Envoi en cours‚Ä¶';
        try{
          const fd = new FormData(form);
          const res = await fetch(form.action, {
            method: 'POST',
            body: fd,
            headers: { 'Accept': 'application/json' }
          });
          if (res.ok) {
            if (orderResult) orderResult.textContent = 'Merci ! Votre commande a √©t√© envoy√©e ‚úÖ';
            // Vider le panier + options + commentaire (sans fermer le tiroir)
            document.querySelectorAll('.qty[data-item]').forEach(q=>q.textContent='0');
            document.querySelectorAll('.opt-qty').forEach(q=>q.textContent='0');
            const bagQtyEl = document.getElementById('bagQty');
            const bagInput = document.getElementById('bagInput');
            if (bagQtyEl) bagQtyEl.textContent = '1';
            if (bagInput) bagInput.value = '1';
            document.getElementById('comments').value = '';
            document.getElementById('deliveryDate').value = '';
            document.getElementById('deliveryTime').value = '';
            // Mettre √† jour l‚ÄôUI
            if (typeof updateSticky === 'function') updateSticky();
            buildRecap();
            setStep('cart');
          } else {
            // Fallback vers soumission native si Formspree refuse la requ√™te fetch
            form.submit();
          }
        } catch(err){
          // Fallback offline / CORS : soumission native
          form.submit();
        }
      });
    }

    // Mise √† jour du r√©cap quand on tape/choisit dans le tiroir
    sheet.addEventListener('input', (e)=>{
      if (e.target.matches('textarea,input')) { buildRecap(); updateMiniRecap(); }
    });

    // R√©agir aux +/- de la liste r√©cap (on modifie les spans du menu)
    recapList.addEventListener('click', (e)=>{
      const btn = e.target.closest('.recap-plus, .recap-minus');
      if (!btn) return;
      const item = btn.dataset.item; // format "CODE- Nom"
      const span = document.querySelector(`.qty[data-item="${CSS.escape(item)}"]`);
      if (!span) return;
      const inc = btn.classList.contains('recap-plus') ? 1 : -1;
      const v = Math.max(0, (parseInt(span.textContent)||0) + inc);
      span.textContent = v; bump(span); updateSticky(); buildRecap();
    });

    // Rebuild r√©cap √† chaque clic +/- sur les articles ou options (menu)
    document.addEventListener('click', (e)=>{
      if (e.target.classList.contains('plus') || e.target.classList.contains('minus') ||
          e.target.classList.contains('opt-plus') || e.target.classList.contains('opt-minus')) {
        setTimeout(()=>{ buildRecap(); updateSticky(); }, 0);
      }
    });

    // ‚úÖ Correctif robuste : observer les changements de quantit√© pour MAJ instantan√©e sans rouvrir le tiroir
    const observer = new MutationObserver(()=>{ if (sheet.classList.contains('open')) { buildRecap(); updateSticky(); }});
    document.querySelectorAll('.qty[data-item]').forEach(el=> observer.observe(el, {childList:true, characterData:true, subtree:true}));

    // Ouvre le tiroir si ancre #panier/#cart
    if (location.hash === '#panier' || location.hash === '#cart') {
      openSheet();
    }
  });
  </script>

  <!-- Script 2 : Ombre du bandeau qui fonce avec le scroll -->
  <script>
  (function(){
    const root = document.documentElement;
    function updateBarShade(){
      const doc = document.documentElement;
      const max = (doc.scrollHeight - window.innerHeight) || 1;
      const p = Math.min(1, Math.max(0, window.scrollY / max)); // 0 top ‚Üí 1 bottom
      const shade = 0.35 + (0.85 - 0.35) * p; // de 0.35 √† 0.85
      root.style.setProperty('--barShade', shade.toFixed(2));
    }
    updateBarShade();
    window.addEventListener('scroll', updateBarShade, { passive:true });
    window.addEventListener('resize', updateBarShade);
  })();
  </script>

  <!-- Script 3 : Donn√©es + Construction du menu + Options + mini r√©cap dans le bandeau -->
  <script>
  (function(){
    const root = document.documentElement;
    function updateBarShade(){
      const doc = document.documentElement;
      const max = (doc.scrollHeight - window.innerHeight) || 1;
      const p = Math.min(1, Math.max(0, window.scrollY / max)); // 0 top ‚Üí 1 bottom
      const shade = 0.35 + (0.85 - 0.35) * p; // de 0.35 √† 0.85
      root.style.setProperty('--barShade', shade.toFixed(2));
    }
    updateBarShade();
    window.addEventListener('scroll', updateBarShade, { passive:true });
    window.addEventListener('resize', updateBarShade);
  })();
  </script>

  <!-- Script 3 : Donn√©es + Construction du menu + Options + mini r√©cap dans le bandeau -->
  <script>
  /* ===================== Donn√©es ===================== */
  const categories = {
    'Maki 4 pi√®ces': [
      'M1- Saumon','M2- Saumon/Avocat','M3- Saumon/Cheese',
      /* 'M4- Thon' RETIR√â */
      'M5- Concombre','M6- Concombre/Cheese','M7- Avocat','M8- Avocat/Cheese',
      'M9- Fromage'
    ],
    'California 4 pi√®ces': [
      'C1- Saumon','C2- Saumon/Avocat','C3- Saumon/Cheese',
      /* 'C4- Thon' RETIR√â */
      'C5- Concombre','C6- Concombre/Cheese','C7- Avocat','C8- Avocat/Cheese',
      'C9- Fromage'
    ],
    'Maki printemps 4 pi√®ces': [
      'P1- Saumon/Avocat','P2- Saumon/Fromage','P3- Concombre/Fromage','P4- Avocat/Fromage'
    ],
    'Signature 4 pi√®ces': [
      'S1- California Saumon/Cheese/Oignons frits','S2- Rols Saumon/Avocat/Cheese'
    ],
    'Sashimi 2 pi√®ces': ['Saumon'],
    'Nigiri 2 pi√®ces': ['N1- Saumon','N2- Avocat']
  };

  const prices = {
    // üí∂ Modifiez librement ces prix (en ‚Ç¨)
    M1:4.00, M2:4.20, M3:4.20, /*M4:4.20*/ M5:3.80, M6:3.80, M7:3.80, M8:4.00, M9:3.80,
    C1:4.80, C2:5.00, C3:5.00, /*C4:5.00*/ C5:4.20, C6:4.20, C7:4.20, C8:4.50, C9:4.20,
    P1:5.20, P2:5.20, P3:4.80, P4:4.80,
    S1:5.80, S2:5.80,
    N1:3.50, N2:3.20
  }; // ex: {'M1':4.00}


  /* ===================== Construction du menu ===================== */
  function buildMenu(){
    const menu=document.getElementById('menu');
    for(const [cat,items] of Object.entries(categories)){
      const wrap=document.createElement('div');
      wrap.className='category';
      wrap.innerHTML=`<h3>${cat}</h3><div class="menu-grid"></div>`;
      const grid=wrap.querySelector('.menu-grid');

      items.forEach(item=>{
        const code=item.split('-')[0].trim();
        const name=item.split('-').slice(1).join('-').trim();
        const price=prices[code];

        const card=document.createElement('div');
        card.className='item-card';
        card.innerHTML=`
          <div class="left">
            <img class="thumb" src="images/${code.toLowerCase()}.jpg" alt="${name || item}" onerror="this.style.display='none'">
            <div class="item-name">${name || item}</div>
          </div>
          <div class="controls">
            ${price!==undefined?`<span class="muted" style="margin-right:6px">${price.toFixed(2)}‚Ç¨</span>`:''}
            <button class="btn minus" data-item="${code}- ${name || item}">‚àí</button>
            <span class="qty" data-item="${code}- ${name || item}">0</span>
            <button class="btn plus" data-item="${code}- ${name || item}">+</button>
          </div>`;
        grid.appendChild(card);
      });

      menu.appendChild(wrap);
    }
  }
  buildMenu();

  /* ===================== Utilitaires ===================== */
  function bump(el){ el.classList.add('bump'); setTimeout(()=>el.classList.remove('bump'),200); }
  function getTotal(){ let t=0; document.querySelectorAll('.qty[data-item]').forEach(q=>t+=parseInt(q.textContent)||0); return t; }
  function getTotalPrice(){
    let total=0;
    document.querySelectorAll('.qty[data-item]').forEach(span=>{
      const q = parseInt(span.textContent)||0;
      if(q>0){
        const code = (span.dataset.item.split('-')[0]||'').trim();
        const p = prices[code];
        if (typeof p === 'number') total += p*q;
      }
    });
    return total;
  }

  function updateMiniRecap(){
    const items=[]; 
    document.querySelectorAll('.qty[data-item]').forEach(span=>{ 
      const q=parseInt(span.textContent)||0; 
      if(q>0){
        const full = span.dataset.item;
        const name = full.split('-').slice(1).join('-').trim();
        items.push(`${name} x${q}`);
      } 
    });
    const c = document.getElementById('comments')?.value?.trim();
    const parts = [];
    if(items.length) parts.push(items.join(' ‚Ä¢ '));
    if(c) parts.push('üí¨ ' + (c.length>40? c.slice(0,40)+'‚Ä¶': c));
    const mini=document.getElementById('miniRecap');
    mini.textContent = parts.length? parts.join(' ‚Äî '): 'Votre panier est vide pour le moment.';
  }

  function updateSticky(){
    const count = getTotal();
    const total = getTotalPrice();
    const btn = document.getElementById('gotoOrder');
    btn.textContent = total>0 ? `Panier (${count}) ‚Ä¢ ${total.toFixed(2)}‚Ç¨ ‚Ä¢ Valider` : `Panier (${count}) ‚Ä¢ Valider`;
    updateMiniRecap();
  }) ‚Ä¢ Valider`;
    updateMiniRecap();
  }

  document.addEventListener('click', e=>{
    if(e.target.classList.contains('plus') || e.target.classList.contains('minus')){
      const inc = e.target.classList.contains('plus') ? 1 : -1;
      const item = e.target.dataset.item;
      const span = document.querySelector(`.qty[data-item="${CSS.escape(item)}"]`);
      const v = Math.max(0, (parseInt(span.textContent)||0) + inc);
      span.textContent = v; bump(span); updateSticky();
    }
  });

  // Baguettes
  const bagMinus = document.getElementById('bagMinus');
  const bagPlus  = document.getElementById('bagPlus');
  const bagQty   = document.getElementById('bagQty');
  const bagInput = document.getElementById('bagInput');
  if (bagMinus && bagPlus && bagQty && bagInput){
    bagMinus.onclick = ()=>{ const v=Math.max(0,(parseInt(bagQty.textContent)||0)-1); bagQty.textContent=v; bagInput.value=v; bump(bagQty); };
    bagPlus.onclick  = ()=>{ const v=(parseInt(bagQty.textContent)||0)+1; bagQty.textContent=v; bagInput.value=v; bump(bagQty); };
  }

  // Options +/-
  document.querySelectorAll('.opt-plus').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const key = btn.dataset.opt;
      const qtyEl = document.querySelector(`.opt-qty[data-opt="${key}"]`);
      qtyEl.textContent = parseInt(qtyEl.textContent) + 1;
      bump(qtyEl); updateMiniRecap();
    });
  });
  document.querySelectorAll('.opt-minus').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const key = btn.dataset.opt;
      const qtyEl = document.querySelector(`.opt-qty[data-opt="${key}"]`);
      qtyEl.textContent = Math.max(0, parseInt(qtyEl.textContent) - 1);
      bump(qtyEl); updateMiniRecap();
    });
  });

  function collectOptions(){
    const opts=[];
    const optionKeys = ['sojaSucree','sojaSalee','wasabi','gingembre'];
    optionKeys.forEach(key=>{
      const el = document.querySelector(`.opt-qty[data-opt="${key}"]`);
      const qty = el ? parseInt(el.textContent)||0 : 0;
      if(qty>0){
        const label = key.replace('sojaSucree','Soja sucr√©e')
                         .replace('sojaSalee','Soja sal√©e')
                         .replace('wasabi','Wasabi')
                         .replace('gingembre','Gingembre');
        opts.push(`${label} x${qty}`);
      }
    });
    const bag = parseInt(bagQty?.textContent)||0;
    return {opts, bag};
  }

  // CTA "Commander maintenant" ‚Üí vers le menu
  document.getElementById('ctaOrder').onclick = ()=> document.getElementById('menuSection').scrollIntoView({behavior:'smooth'});

  // Init
  updateSticky();
  updateMiniRecap();
  </script>

  <!-- Petit correctif ancien script d'ouverture/fermeture si doublon -->
  <script>
  document.addEventListener('DOMContentLoaded', function(){
    var btnOpen    = document.getElementById('gotoOrder');
    var sheet      = document.getElementById('cartSheet');
    var sheetClose = document.getElementById('sheetClose');

    function openSheet(){ if (!sheet) return; sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false'); }
    function closeSheet(){ if (!sheet) return; sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }

    if (btnOpen)    btnOpen.addEventListener('click', openSheet);
    if (sheetClose) sheetClose.addEventListener('click', closeSheet);

    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape' && sheet && sheet.classList.contains('open')) closeSheet();
    });
  });
  </script>

</body>
</html>
