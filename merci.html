<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Merci pour votre commande ‚Äî YUMEKO SUSHIS</title>

  <!-- Police Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#8b0000; --brand-2:#a31212; --text:#f8f8f8;
      --card:#1b1b1b; --muted:#cfcfcf; --ok:#00d78f;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#0f0f0f 0%, #8b0000 100%); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{
      width:min(900px,96vw);
      background:#160c0c; border:1px solid rgba(255,255,255,.08);
      border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      padding:24px;
    }
    .head{
      display:flex; align-items:center; gap:14px; margin-bottom:8px;
    }
    .ok{
      width:42px; height:42px; border-radius:50%; background:rgba(0,215,143,.12);
      display:grid; place-items:center; font-size:24px; color:var(--ok);
      border:1px solid rgba(0,215,143,.35);
    }
    h1{ font-size:1.8rem; margin:0; letter-spacing:.5px; }
    p.muted{ color:var(--muted); margin:6px 0 18px; }

    .card{
      background:#1b1b1b; border:1px solid rgba(255,255,255,.08);
      border-radius:14px; padding:16px; margin-top:12px;
    }
    .grid{
      display:grid; grid-template-columns:1fr; gap:10px; margin-bottom:12px;
    }
    .row{ display:flex; gap:8px; flex-wrap:wrap; }
    .label{ width:180px; color:#cfcfcf; }
    .val{ font-weight:700; color:#fff; }

    .table{
      width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; margin-top:6px;
      border:1px solid rgba(255,255,255,.08);
    }
    .table th, .table td{ padding:10px 12px; text-align:left; }
    .table thead th{ background:#1f1f1f; color:#fff; font-weight:700; }
    .table tbody tr:nth-child(odd){ background:#191919; }
    .table tbody tr:nth-child(even){ background:#161616; }
    .table td.qty{ width:80px; }

    pre{
      white-space:pre-wrap; word-wrap:break-word; background:#141414; border:1px solid rgba(255,255,255,.08);
      padding:14px; border-radius:12px; margin:0;
    }

    .actions{
      margin-top:18px; display:flex; gap:10px; flex-wrap:wrap;
    }
    .btn{
      border:none; border-radius:12px; padding:12px 16px; font-weight:900; cursor:pointer;
    }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-primary:hover{ background:var(--brand-2); }
    .btn-ghost{ background:#2a2a2a; color:#fff; }
    .btn-ghost:hover{ filter:brightness(1.1); }

    footer{
      text-align:center; color:#d7d7d7; margin-top:20px; font-size:.9rem;
      opacity:.9;
    }

    @media print{
      body{ background:#fff; }
      .wrap{ box-shadow:none; border-color:#ccc; }
      .actions, footer{ display:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="ok">‚úì</div>
      <div>
        <h1>Merci pour votre commande !</h1>
        <p class="muted">Nous vous avons envoy√© un e-mail de confirmation avec le r√©capitulatif.</p>
      </div>
    </div>

    <!-- Bloc r√©sum√© client + commentaire -->
    <div id="summary" class="card" style="display:none">
      <div class="grid">
        <div class="row"><div class="label">Client</div><div class="val" id="c_client">‚Äî</div></div>
        <div class="row"><div class="label">Email</div><div class="val" id="c_email">‚Äî</div></div>
        <div class="row" id="row_comment" style="display:none"><div class="label">Allergies / autres</div><div class="val" id="c_comment">‚Äî</div></div>
      </div>
    </div>

    <!-- Tableau des articles -->
    <div id="itemsCard" class="card" style="display:none">
      <h2 style="margin:0 0 10px;font-size:1.2rem">Articles</h2>
      <table class="table" id="itemsTable">
        <thead>
          <tr><th>Article</th><th class="qty">Quantit√©</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Rendu brut (fallback) -->
    <div id="rawCard" class="card" style="display:none">
      <h2 style="margin:0 0 10px;font-size:1.2rem">R√©capitulatif</h2>
      <pre id="rawText"></pre>
    </div>

    <div class="actions">
      <button class="btn btn-primary" onclick="window.print()">Imprimer</button>
      <a class="btn btn-ghost" href="./">Retour √† l‚Äôaccueil</a>
    </div>

    <footer>¬© 2025 YUMEKO SUSHIS ‚Äî √Ä tr√®s vite üç£</footer>
  </div>

  <script>
    (function(){
      // R√©cup√®re le texte stock√© par la page principale
      const raw = localStorage.getItem('yumeko_last_order') || '';

      // Elements
      const summary = document.getElementById('summary');
      const itemsCard = document.getElementById('itemsCard');
      const rawCard = document.getElementById('rawCard');
      const rawText = document.getElementById('rawText');
      const cClient = document.getElementById('c_client');
      const cEmail = document.getElementById('c_email');
      const cComment = document.getElementById('c_comment');
      const rowComment = document.getElementById('row_comment');
      const tbody = document.querySelector('#itemsTable tbody');

      if(!raw.trim()){
        // Pas de donn√©es -> fallback simple
        rawCard.style.display = 'block';
        rawText.textContent = "Aucune commande trouv√©e.\n\nAstuce : passez la commande depuis la page principale pour voir ici le r√©capitulatif.";
        return;
      }

      // Affiche toujours le bloc brut en backup (pli√© derri√®re si parse ok)
      rawCard.style.display = 'block';
      rawText.textContent = raw;

      // === Parsing simple & robuste de la structure connue ===
      // Cherche les lignes "Client :", "Email :", "Allergies / autres :" et les bullets "- ..."
      const lines = raw.split(/\r?\n/);
      let client = '‚Äî', email = '‚Äî', comment = '';
      const items = [];

      let inArticles = false;
      for(const line of lines){
        const l = line.trim();

        if(/^Client\s*:/i.test(l)){
          client = l.replace(/^Client\s*:\s*/i,'').trim() || '‚Äî';
        } else if(/^Email\s*:/i.test(l)){
          email = l.replace(/^Email\s*:\s*/i,'').trim() || '‚Äî';
        } else if(/^Allergies?\s*\/\s*autres\s*:/i.test(l)){
          comment = l.replace(/^Allergies?\s*\/\s*autres\s*:\s*/i,'').trim();
        } else if(/^Articles\s*:/i.test(l)){
          inArticles = true;
        } else if(inArticles && /^- /.test(l)){
          // ligne d'article "- NOM xQTY"
          const itemTxt = l.replace(/^- /,'').trim();
          const m = itemTxt.match(/^(.*)\s+x(\d+)$/i);
          if(m){
            items.push({ name:m[1].trim(), qty:parseInt(m[2],10) });
          }else{
            // Si pas de "xQTY", qty=1 par d√©faut
            items.push({ name:itemTxt, qty:1 });
          }
        } else if(inArticles && l===''){
          // Ligne vide apr√®s la liste -> on arr√™te
          inArticles = false;
        }
      }

      // Remplissage de la carte r√©sum√©
      cClient.textContent = client || '‚Äî';
      cEmail.textContent = email || '‚Äî';
      if(comment){
        rowComment.style.display = '';
        cComment.textContent = comment;
      }
      summary.style.display = 'block';

      // Remplissage du tableau articles si on a des items
      if(items.length){
        items.forEach(({name, qty})=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${name}</td><td class="qty">${qty}</td>`;
          tbody.appendChild(tr);
        });
        itemsCard.style.display = 'block';
      }
    })();
  </script>
</body>
</html>
